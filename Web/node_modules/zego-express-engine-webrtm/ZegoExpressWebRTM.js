!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(r,s,function(t){return e[t]}.bind(null,s));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=12)}([function(e,t,o){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.LoggerStateCenter=t.ZegoDataReport=t.ZegoLogger=t.LinkedList=t.ListNode=t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.E_CLIENT_TYPE=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.9.0",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallProgram=2]="ClientType_SmallProgram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={})),t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(r=1,function(){return r++}),t.getReportSeq=function(){var e=1;return function(){return e++}}();var s=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=s;var i=function(){function e(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var o=new s(this._idCounter,t);return o.next=e,o.prev=e.prev,e.prev&&(e.prev.next=o),e.prev=o,++this._idCounter,++this._numNodes,o},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,o=this.start.next;if(e>=0)for(;t<e&&null!==o;)o=o.next,++t;else o=null;if(null===o)throw"Index out of bounds.";return o},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,o=!1,r=null;t.hasNext()&&!o;)e(t=t.next)&&(r=t,o=!0);return r},e.prototype.map=function(e){for(var t=this.start,o=[];t.hasNext();)e(t=t.next)&&o.push(t);return o},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i;var n=o(14);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}}),Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return n.LoggerStateCenter}}),Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return n.createZegoWebSocket}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},TRANS_FREQUENTLY:{code:1102022,msg:"trans send frequently"},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",e.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",e.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",e.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",e.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",e.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM="zm.scc",e.ZEGOEXPRESSWEBRTM_SEND_BCM="zm.sbcm",e.ZEGOEXPRESSWEBRTM_SEND_RLM="zm.srlm",e.ZEGOEXPRESSWEBRTM_SEND_BRM="zm.sbrm",e.ZEGOEXPRESSWEBRTM_SEND_RAM="zm.sram",e.ZEGOEXPRESSWEBRTM_ON="zm.on",e.ZEGOEXPRESSWEBRTM_OFF="zm.off",e.ZEGOEXPRESSWEBRTM_RENEWTOKEN="zm.rntk",e.ZEGOEXPRESSWEBRTM_RESETTOKENTIMER="zm.rstt",e.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM="zm.emr",e.ZEGOEXPRESSWEBRTM_SEND_PB="zm.spb",e.ZEGOEXPRESSWEBRTM_GET_HEADER="zm.gh",e.ROOM_LOGIN_ROOM="zm.rm.lg",e.ROOM_TRY_LOGIN="zm.rm.tl",e.ROOM_OPEN_HANDLER="zm.rm.op",e.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",e.ROOM_CLOSEHANDLER="zm.rm.clh",e.ROOM_LOGOUT="zm.rm.lo",e.ROOM_RESET_ROOM="zm.rm.rr",e.ROOM_DISCONNECT="zm.rm.dcn",e.ROOM_KICK_OUT="zm.rm.kco",e.ROOM_STATUS_CALLBACK="zm.rm.scb",e.ROOM_RESETTOKEN_TIMER="zm.rm.rst",e.HEARTBEAT_START="zm.hb.st",e.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",e.HEARTBEAT_RESET="zm.hb.rst",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd",e.USER_LOGIN_RSP="zm.us.lgr",e.USER_FETCH_USER="zm.us.ftu",e.USER_FETCH_USER_RSP="zm.us.urp",e.USER_USER_PUSH="zm.us.uph",e.USER_MERGE_SEQ="zm.us.mg",e.USER_MERGE_TIMEOUT="zm.us.mto",e.USER_MERGE="zm.us.mg",e.USER_HB_PATCH="zm.us.pt",e.MESSAGE_SEND_RELIABLE="zm.msg.sdr",e.MESSAGE_FETCH_RELIABLE="zm.msg.frm",e.MESSAGE_RELIABLE_RSP="zm.msg.rlr",e.MESSAGE_RELIABLE_PUSH="zm.msg.rps",e.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",e.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",e.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",e.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",e.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",e.LIVE_SEND_SIGNAL="zm.lv.ssg",e.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",e.LIVE_PUSH_SIGNAL="zm.lv.pss",e.STATE_ACTION="zm.st.at",e.ZEGOEXPRESSWEBRTM_LOGIN_HALL="zm.lh",e.ZEGOEXPRESSWEBRTM_LOGOUT_HALL="zm.loh",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE="zm.scm"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var r=o(15),s=o(0),i=o(1),n=function(){function e(){}return e.checkConfigParam=function(e,t,o){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(o.error("ccp.0 server must be string or string array and not empty"),!1):(o.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkPriConfigParam=function(e,t,o,r,s){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof o||"string"!=typeof o.deviceID?(s.error("ccp.0 deviceID must be string and not empty"),!1):1===r||0===r||(s.error("ccp.0 anType must be 0 or 1"),!1):(s.error("ccp.0 dispatchServer must be string and not empty"),!1):(s.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,o){var r,s;t.success&&(r=t.success,o[e+"SuccessCallback"]=r),t.error&&(s=t.error,o[e+"ErrorCallback"]=s)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,o,r,s){e.registerCallback(t,{success:function(t,s){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.dataReportEvent(o,r,t,s,i)}},s)},e.proxyRes=function(t,o,r,s){return{interResolve:function(e){t.uploadReport(o),r(e)},interReject:function(r,i){var n;void 0===i&&(i=""),(n=r.code<2e9&&r.code>1e9?e.decodeServerError(r.code,r.msg):{code:r.code,message:r.msg})&&t.addMsgInfo(o,{error:n.code,message:n.message+i}),t.uploadReport(o),s({errorCode:r.code})}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return i.errorCodeList.SUCCESS;var o=i.errorCodeList.ROOM_INNER_ERROR;return o.code=e,o.msg=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,o},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var o={code:-1,message:"server error"};return o.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(o.message=t),o},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={code:e,message:"kickout reason = "+e};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,o,r,s){switch(o){case"eventStart":e.eventStart(t,r);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,r,s[0]);break;case"addEventMsg":e.addEventMsg(t,r,s[0],s[1]);break;case"addEvent":e.addEvent(t,r);break;case"eventEnd":e.eventEnd(t,r);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeUserList=function(e,t,o,r){e.debug("msl.0 call");var s,i=[],n=[];o||(o=[]);for(var a=0;a<o.length;a++){s=!1;for(var l=0;l<t.length;l++)if(o[a].userID===t[l].userID){s=!0;break}s||i.push(o[a])}for(var g=0;g<t.length;g++){s=!1;for(var d=0;d<o.length;d++)if(t[g].userID===o[d].userID){s=!0;break}s||n.push(t[g])}t.splice(0);for(a=0;a<o.length;a++)t.push(t[a]);r(i,n),e.debug("msl.0 call success")},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,o){return t=t||1,o=o||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=o},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||r.length,e)for(o=0;o<e;o++)s[o]=r[0|Math.random()*t];else{var i=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",o=0;o<36;o++)s[o]||(i=0|16*Math.random(),s[o]=r[19==o?3&i|8:i])}return s.join("")},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var o=Math.max(e.length,t.length);e.length<o;)e.push("0");for(;t.length<o;)t.push("0");for(var r=0;r<o;r++){var s=parseInt(e[r]),i=parseInt(t[r]);if(s>i)return 1;if(s<i)return-1}return 0},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),o=-1!=e.indexOf("Firefox"),r=null!=window.opr,s=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":o?"Firefox":r?"Opera":s?"Chrome":i?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.getLogLevel=function(e){return s.LOG_LEVEL[e]},e.getUint64=function(e,t,o){var r=o.getUint32(e,t),s=o.getUint32(e+4,t),i=t?r+Math.pow(2,32)*s:Math.pow(2,32)*r+s;return Number.isSafeInteger(i)||console.warn(i,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),i},e.decodeTokenExpire=function(t){try{var o=Uint8Array.from(r.Base64.base64decode(t),(function(e){return e.charCodeAt(0)})),s=new DataView(o.buffer),i=void 0;return i="function"==typeof s.getBigInt64?s.getBigUint64(0):e.getUint64(0,!1,s),Number(i>0?i:s.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},e}();t.ClientUtil=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var r=o(1),s=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:r.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:s},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:r.errorCodeList.INPUT_PARAM},log_level:function(e){return e},remote_log_level:s,log_url:s},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:s,max_member_count:s,message:s,token:s,error:{ROOM_ID_NULL:r.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:r.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:r.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:r.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:r.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:r.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:r.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:r.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:r.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:r.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:r.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:r.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:r.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,NOT_LOGIN:r.errorCodeList.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,ROOM_NOT_EXIST:r.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:r.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:r.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskLoginHall:{event:"/sdk/login_hall",user_update:s,device_id:s,message:s,token:s,device_type:s,an_type:s,room_flag:s,test_environment:s,error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,USER_ID_NULL:r.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:r.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:r.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:r.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:r.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:r.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:r.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:r.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:r.errorCodeList.NETWORK_BROKEN},subEvent:{dispatch_connection:{event:"dispatch_connection"},create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskLogoutHall:{event:"/sdk/logout_hall",error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM}},kZegoTaskEnterRoom:{event:"/sdk/enter",role:s,error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,ROOM_ID_NULL:r.errorCodeList.ROOM_ID_NULL,ROOM_ID_TOO_LONG:r.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:r.errorCodeList.ROOM_ID_INVALID_CHARACTER,NOT_LOGIN:r.errorCodeList.NOT_LOGIN,REPEATEDLY_ENTER_ROOM:r.errorCodeList.REPEATEDLY_ENTER_ROOM}},kZegoTaskLeaveRoom:{event:"/sdk/leave",error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM}},kZegoTaskReLoginHall:{event:"/sdk/relogin",error:{ROOM_ID_NULL:r.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:r.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:s,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:s,room_id:s,message:s},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:s,error:{NOT_LOGIN:r.errorCodeList.NOT_LOGIN,HB_TIMEOUT:r.errorCodeList.TIMEOUT}},kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:s,error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:r.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:r.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:r.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:s,error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:r.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:r.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:r.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:s,error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:r.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:r.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:r.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:s,error:{INPUT_PARAM:r.errorCodeList.INPUT_PARAM,TRANS_FREQUENTLY:r.errorCodeList.TRANS_FREQUENTLY,ROOM_NOT_EXIST:r.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:s},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:s},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:r.errorCodeList.INPUT_PARAM,kAlreadyLoginError:r.errorCodeList.ALREADY_LOGIN}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryHandler=void 0;var r=function(){function e(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,o,r){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof o&&(this.RETRY_CONTINUE_COUNT=o),"number"==typeof r&&(this.RETRY_MAX_TIME_INTERVAL=r)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeatHandler=void 0;var r=o(0),s=o(3),i=o(1),n=o(2),a=o(4),l=3,g=function(){function e(e,t,o,r,s){this.logger=e,this.stateCenter=t,this.dataReport=o,this.service=r,this.room=s,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}return e.prototype.init=function(e){var t,o=this;if("PRIVATE"==this.stateCenter.type){t=e.body.hb_interval<r.MINIUM_HEARTBEAT_INTERVAL?r.MINIUM_HEARTBEAT_INTERVAL:e.body.hb_interval;var s=e.body.hb_timeout||4e4;l=s/t+1}else t=e.body.hearbeat_interval<r.MINIUM_HEARTBEAT_INTERVAL?r.MINIUM_HEARTBEAT_INTERVAL:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){o.start(t)}),t),this.initCount++},e.prototype.start=function(e){var t=this;this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var o=r.getReportSeq();if(this.dataReport.newReport(o,a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(o,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(o,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(o);if(++this.tryHeartbeatCount>l)return this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(o,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(o),void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT);var g=function(e){var r="PRIVATE"==t.stateCenter.type?e.body&&e.body.code:e.body&&e.body.err_code;if(e.header&&e.body){if(0!==r){var n=s.ClientUtil.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message);t.dataReport.addMsgInfo(o,{error:n.code,message:n.message+e.body.err_code})}}else t.dataReport.addMsgInfo(o,{error:e.code>0?e.code:i.errorCodeList.ROOM_INNER_ERROR.code,message:e.msg?e.msg:i.errorCodeList.ROOM_INNER_ERROR});t.dataReport.uploadReport(o),"PRIVATE"==t.stateCenter.type?t.handlePrivateHeartbeatRsp(e):t.handleHeartbeatRsp(e)};this.service.heartBeat(g,g,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.heartbeatInterval=e;var d=this.heartbeatInterval;this.initCount>=2?(d=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):d=this.heartbeatInterval,this.heartbeatTimer=setTimeout((function(){t.start(t.heartbeatInterval)}),d),this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},e.prototype.handleHeartbeatRsp=function(e){return e.body&&e.body.err_code&&0!==e.body.err_code?(this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),e.body.err_code==r.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(s.ClientUtil.getServerError(e.body.err_code))):e.header&&e.body?(this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<r.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=r.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),void this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(e)),void this.hbLogout(e))},e.prototype.handlePrivateHeartbeatRsp=function(e){if(0!==e.body.code)return this.logger.error(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.code),e.body.code==r.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(s.ClientUtil.getServerError(e.body.code));this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hb_interval,this.heartbeatInterval<r.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=r.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")},e.prototype.heartbeatRspNotiFy=function(e){},e.prototype.hbLogout=function(e){},e.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(n.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},e}();t.HeartBeatHandler=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveHandler=void 0;var r=o(0),s=o(2),i=o(3),n=o(1),a=function(){function e(e,t,o,r){this.logger=e,this.stateCenter=t,this.service=o,this.room=r,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}return e.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},e.prototype.getSignalCmdContent=function(e,t,o){var r={request_id:e,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t};return null!=o&&(r.result=o),JSON.stringify(r)},e.prototype.requestJoinLive=function(e,t,o,s){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return null!=s&&(this.joinLiveCallbackMap[i]=s,this.sendSignalCmd(r.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,n,e,t,o),!0)},e.prototype.sendSignalCmd=function(e,t,o,r,a){if(this.room.isLogin()){var l={sub_cmd:e,signal_msg:t,dest_id_name:[o]};this.service.sendSignalCmd(l,(function(e){r&&r(e.header.seq)}),(function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(a&&a(t,0));a&&a(i.ClientUtil.getServerError(e.body.err_code),e.header.seq)}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" call success"+e)}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" state error")},e.prototype.inviteJoinLive=function(e,t,o,s){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return null!=s&&(this.joinLiveCallbackMap[i]=s,this.sendSignalCmd(r.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,n,e,t,o),!0)},e.prototype.endJoinLive=function(e,t,o){var s=this.stateCenter.getRequestId(),i=this.getSignalCmdContent(s,e);return this.sendSignalCmd(r.ENUM_SIGNAL_SUB_CMD.joinLiveStop,i,e,t,o),!0},e.prototype.respondJoinLive=function(e,t,o,i){var n=this.joinLiveRequestMap[e];if(!n)return this.logger.info(s.ZEGO_RTM_ACTION.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;var a=0;!0===t&&(a=1);var l=this.getSignalCmdContent(e,n,a);return this.sendSignalCmd(r.ENUM_SIGNAL_SUB_CMD.joinLiveResult,l,n,o,i),delete this.joinLiveRequestMap[e],!0},e.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" hpsm= ",t),e.body.sub_cmd){case r.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case r.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case r.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case r.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var o=e.from_userid;"string"==typeof o?(this.joinLiveRequestMap[t]=o,this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+o)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,o,r){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,o,r)},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var o=e.from_userid;"string"==typeof o?(this.joinLiveRequestMap[t]=o,this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+o)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+"no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,o,r){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,o,r)},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var o=e.result;if(null!=o){var r=1==o;if(this.joinLiveCallbackMap[t]){var i=this.joinLiveCallbackMap[t];if(!i)return void this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no callback");this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+r),delete this.joinLiveCallbackMap[t],i(r,e.from_userid,e.from_username)}}else this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no result")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,o,r){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,o,r)},e}();t.LiveHandler=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var r=o(0),s=o(3),i=o(1),n=o(2),a=o(4),l=function(){function e(e,t,o,r,s){var i=this;this.logger=e,this.stateCenter=t,this.dataReport=o,this.service=r,this.room=s,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=e.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));i.stateCenter.actionListener("roomExtraInfoUpdate",i.room.roomID,t),e.forEach((function(e){i.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)}))},this.realyMessageList=[]}return e.prototype.loginRsp=function(e){var t=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var o=parseFloat(e.body.ret_timestamp);this.serverTimeOffset=0==o?0:e.body.ret_timestamp-(new Date).getTime()}if(e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var r=0;r<e.body.trans_seqs.length;r++){var s=e.body.trans_seqs[r].trans_channel,i=e.body.trans_seqs[r].trans_seq_array;(i=i.filter((function(e){var o=e.trans_type,r=e.trans_seq;return!t.transSeqMap[o]||t.transSeqMap[o].seq<r}))).length>0&&this.fetchReliableMessage(s,i)}},e.prototype.sendReliableMessage=function(e,t,o,r){var l=this;if(this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" call"),this.isReliable)return this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" send too often"),void r(a.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.TRANS_FREQUENTLY);this.transSeqMap[e]||(this.transSeqMap[e]={seq:0});var g={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"};this.isReliable=!0,this.service.sendReliableMessage(g,(function(t){l.transSeqMap[e].seq=t.body.trans_seq,l.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" trans "+e+" seq "+t.body.trans_seq),l.isReliable=!1,o({seq:t.header.seq,errorCode:0})}),(function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;e.body&&e.body.err_code?(t=s.ClientUtil.getServerError(e.body.err_code),l.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+t.msg)):t=e==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:e,l.isReliable=!1,r(t)}),this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.fetchReliableMessage=function(e,t){var o=this,r={trans_channel:e,fetch_array:t},s=function(e){o.handleFetchTransRsp(e)};this.service.fetchReliableMessage(r,s,s,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_FETCH_RELIABLE+" call success")},e.prototype.handleFetchTransRsp=function(e){if(e.body&&0!=e.body.err_code)this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e.body.err_code);else if(e.header&&e.body){var t=e.body.trans_fetch_results,o=[];if(Array.isArray(t)&&t.length>0)for(var s=0;s<t.length;s++){var i=t[s];if(i.err_code!==r.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var a=i.trans_type,l=i.trans_seq;i.err_code!==r.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.transSeqMap[a]||this.transSeqMap[a].seq<l?(this.transSeqMap[a]={seq:l},o.push(i)):this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"),o.length>0&&this.onRecvReliableMessage(o)):(this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+i.err_code),this.transSeqMap[a]={seq:l})}else this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+i.err_code)}}else this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e)},e.prototype.handlePushTransMsg=function(e){var t=e.body.trans_type,o=e.body.trans_seq;!this.transSeqMap[t]||this.transSeqMap[t].seq<o?(this.transSeqMap[t]={seq:o},this.onRecvReliableMessage([e.body])):this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans "+t+" seq "+o)},e.prototype.sendRoomMsg=function(e,t,o,r,a,l){var g=this;if(!this.room.isLogin())return this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" state error"),!1;var d=Date.parse(new Date+"");if(this.sendRoomMsgTime>0&&this.sendRoomMsgTime+this.sendRoomMsgInterval>d)return this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" freq error"),l&&l(i.errorCodeList.FREQ_LIMITED,0,e,r),!1;this.sendRoomMsgTime=d;var _="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_category:e,msg_type:1,msg_content:r}:{msg_category:e,msg_type:1,msg_content:r};return this.service.sendRoomMsg(_,(function(e){a({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})}),(function(e){var t,o,r=i.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(r=e),void l({seq:0,errorCode:r.code,messageID:0});r=(t=[s.ClientUtil.getServerError("PRIVATE"==g.stateCenter.type?e.body.code:e.body.err_code),e.body.msg_id])[0],o=t[1],g.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+r.msg),g.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+r.msg),r==i.errorCodeList.TIMEOUT&&(r=i.errorCodeList.IM_SEND_FAILED),l({seq:e.header.seq,errorCode:r.code,messageID:o})}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  call success"),!0},e.prototype.handlePushRoomMsg=function(e){var t=this,o=r.getReportSeq();this.dataReport.newReport(o),this.dataReport.addMsgInfo(o,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.room_sid(e.header.session_id)});var s=[];"PRIVATE"==this.stateCenter.type?e.body.chat_data.forEach((function(e){var r={fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id};s.push(r),t.dataReport.addMsgInfo(o,{from_msg_id:e.id_name})})):e.body.chat_data.forEach((function(e){var r={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id};s.push(r),t.dataReport.addMsgInfo(o,{from_msg_id:e.id_name})})),this.dataReport.uploadReport(o,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,s),this.stateCenter.actionListener("_recvRoomMsg",e.body.chat_data,e.body.server_msg_id,e.body.ret_msg_id)},e.prototype.sendCustomCommand=function(e,t,o,r){var a=this;if(!this.room.isLogin())return this.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" state error"),!1;var l={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},g="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},request_id:this.stateCenter.getRequestId(),msg:t,destids:e}:{dest_id_name:e,custom_msg:JSON.stringify(l)};return this.service.sendCustomCommand(g,(function(e){o({seq:e.header.seq,errorCode:0})}),(function(e){var t,o=s.ClientUtil.getServerError("PRIVATE"==a.stateCenter.type?e.body.code:e.body.err_code);a.logger.error(n.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" "+o.msg),t=o==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:o,r({seq:e.header.seq,errorCode:t.code})}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0},e.prototype.handlePushCustomMsg=function(e){var t,o,s,i,n,l;if("PRIVATE"==this.stateCenter.type)s=(t=[e.body.from_user_id,e.body.from_user_name,this.room.roomID,e.body.msg])[0],i=t[1],n=t[2],l=t[3];else{var g=JSON.parse(e.body.custommsg);s=(o=[g.from_userid,g.from_username,g.room_id,g.custom_content])[0],i=o[1],n=o[2],l=o[3]}var d=r.getReportSeq();this.dataReport.newReport(d),this.dataReport.uploadReport(d,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",n,{userID:s,userName:i},l)},e.prototype.sendBigRoomMessage=function(e,t,o,s,i,n){var a=this,l=this.bigimTimeWindow,g=this.serverTimeOffset,d=(new Date).getTime()+g,_=r.getSeq().toString();if(this.bigImCallbackMap[_]={success:i,error:n},0==l){var u={msg_category:e,msg_type:1,msg_content:s,bigmsg_client_id:_};this.sendBigRoomMessageInternal([u],(function(e){a.handleBigImMsgRsp(e)}),(function(e){n&&n(e)}))}else{var c=Math.floor(d/l);if(this.bigImLastTimeIndex<c&&0==this.bigIMmessageList.length){this.bigImLastTimeIndex=c;var h={msg_category:e,msg_type:1,msg_content:s,bigmsg_client_id:_};this.sendBigRoomMessageInternal([h],(function(e){a.handleBigImMsgRsp(e)}),(function(e){n&&n(e)}))}else this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:s,bigmsg_client_id:_}),1==this.bigIMmessageList.length&&this.setBigImTimer(g,l)}},e.prototype.sendBigRoomMessageInternal=function(e,t,o){var r={msgs:e};this.service.sendBigRoomMessage(r,(function(e){t(e)}),(function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;e.header&&e.body||(e.code&&e.msg&&(t=e),o(t)),o(t)}),this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},e.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=0;t<e.body.msgs.length;t++){var o=e.body.msgs[t].bigmsg_client_id,r=e.body.msgs[t].bigmsg_id;if(this.bigImCallbackMap[o]){var s=this.bigImCallbackMap[o].success;null!=s&&s({seq:e.header.seq,errorCode:0,messageID:r}),delete this.bigImCallbackMap[o]}}},e.prototype.setBigImTimer=function(e,t){var o=this,r=t-((new Date).getTime()+e)%t,i=s.ClientUtil.generateRandumNumber(t)+r;this.bigImTimer=setTimeout((function(){o.onBigImTimer()}),i)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.serverTimeOffset;this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow);for(var o=[],r=[],s=0;s<this.bigIMmessageList.length&&!(s>=20);s++){var i=this.bigIMmessageList[s];o.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),r.push(i.bigmsg_client_id)}this.bigIMmessageList.length>20?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(o,(function(t){e.handleBigImMsgRsp(t)}),(function(t,o){for(var s=0;s<r.length;s++){var i=r[s],n=e.bigImCallbackMap[i];n&&(null!=n.error&&n.error(t,o),delete e.bigImCallbackMap[i])}})),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,this.bigIMmessageList.length>0&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},e.prototype.handlePushMergeMsg=function(e){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body)},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"parse json error")}if(t){for(var o=t.room_id,r=[],s=0;s<t.msg_data.length;s++){var i=t.msg_data[s];i.id_name!=this.stateCenter.idName?r.push({idName:i.id_name,nickName:i.nick_name,messageId:i.bigmsg_id,category:i.msg_category,type:i.msg_type,content:i.msg_content,time:i.send_time}):this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" self message")}0==r.length?this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(r,o),this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(n.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){var o=r.getReportSeq();this.dataReport.newReport(o);var s=[];e.forEach((function(e){var t={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId};s.push(t)})),this.dataReport.uploadReport(o,a.ZegoRTMLogEvent.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",t,s),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},e.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},e.prototype.sendRelayMessage=function(e,t,o,r){var s=this.datiTimeWindow,i=this.serverTimeOffset;s>0?(this.realyMessageList.push({type:e,data:t,success:o,error:r}),1==this.realyMessageList.length&&this.setRelayTimer(i,s)):this.sendRelayMessageInternal(e,t,o,r)},e.prototype.sendRelayMessageInternal=function(e,t,o,r){this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" call");var a={relay_type:e,relay_data:t},l=this.room;this.service.sendRelayMessage(a,(function(e){o&&o(e.header.seq,e.body.relay_result)}),(function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(r&&r(t,0));r&&r(s.ClientUtil.getServerError(e.body.err_code),e.header.seq)}),l.sessionID,l.roomID,l.roomSessionID)},e.prototype.setRelayTimer=function(e,t){var o=this,r=2*t-((new Date).getTime()+e)%t,i=s.ClientUtil.generateRandumNumber(r);this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" setTimer "+i),this.relayTimer=setTimeout((function(){o.onRelayTimer()}),i)},e.prototype.onRelayTimer=function(){if(0!=this.realyMessageList.length){var e=this.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),this.realyMessageList.length>0&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow)}else this.logger.info(n.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+"  no relay data")},e.prototype.getRoomChatInfo=function(e,t,o,r){if(this.logger.debug("zb.mh.grc call"),this.room.isLogin()){var s={room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_id:e,msg_count:t},i=function(e,t){if(0!==e.body.code)r({errorCode:e.body.code,extendData:e.body.message||""});else{var s=e.body.msg_data.map((function(e){return{fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}}));o({chatData:s})}};this.service.sendMessage("zegochat_js.room_im_chat_fetch",s,i,i),this.logger.info("zb.mh.grc call success")}else this.logger.error("zb.mh.srm no enter room")},e}();t.MessageHandler=l},function(e,t,o){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var o=0,r=t.length,s=e.length;o<r;o++,s++)e[s]=t[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.UserHandler=void 0;var s=o(0),i=o(3),n=o(2),a=o(4),l=function(){function e(e,t,o,r,s){this.logger=e,this.stateCenter=t,this.dataReport=o,this.service=r,this.room=s,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap={},this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return e.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info(n.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},e.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(n.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},e.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},e.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},e.prototype.fetchUserListWithPage=function(e,t){var o=this,r=function(e){"PRIVATE"==o.stateCenter.type?o.handleFetchUserListPrivateRsp(e):o.handleFetchUserListRsp(e,t)};"PRIVATE"==this.stateCenter.type&&(this.room.roomID,this.room.roomSid,this.room.roomSessionID),"V1"===s.ROOMVERSION?this.service.fetchUserList({user_index:e,sort_type:0},r,r,this.room.sessionID,this.room.roomID,this.room.roomSessionID):this.service.fetchUserListV2({marker:0===e?"":e+"",mode:0,limit:100},r,r,this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.handleFetchUserListRsp=function(e,t){var o=this;if(e.body&&0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(!e.header||!e.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e);if(this.stateCenter.userStateUpdate){this.userTempList=r(r([],this.userTempList),e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(a+1,t);this.userSeq=e.body.server_user_seq;for(var l=[],g=[],d=0;d<this.userTempList.length;d++){var _={userID:this.userTempList[d].id_name,userName:this.userTempList[d].nick_name,role:this.userTempList[d].role};l.push(_),g.push({idName:this.userTempList[d].id_name,nickName:this.userTempList[d].nick_name,role:this.userTempList[d].role})}this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,g),t==s.ENUM_RUN_STATE.login?(this.userList&&i.ClientUtil.mergeUserList(this.logger,this.userList,l,(function(e,t){0!==e.length&&o.onUserStateUpdate(o.room.roomID,"ADD",e),0!==t.length&&o.onUserStateUpdate(o.room.roomID,"DELETE",t)})),this.userList=l):(this.userList=l,0!==l.length&&this.onUserStateUpdate(this.room.roomID,"ADD",l)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+l+" count "+l.length)}},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==e.body.user_list_seq)if(this.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.userSeq=e.body.user_list_seq;var t,o,r=[];if("PRIVATE"==this.stateCenter.type){t=0,o=1;for(var s=0;s<e.body.user_actions.length;s++){var i={action:e.body.user_actions[s].action,idName:e.body.user_actions[s].user_id,nickName:e.body.user_actions[s].user_name,role:e.body.user_actions[s].role,loginTime:e.body.user_actions[s].login_time};r.push(i)}}else{t=1,o=2;for(s=0;s<e.body.user_actions.length;s++){i={action:e.body.user_actions[s].Action,idName:e.body.user_actions[s].IdName,nickName:e.body.user_actions[s].NickName,role:e.body.user_actions[s].Role,loginTime:e.body.user_actions[s].LoginTime};r.push(i)}this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,r)}var a=[],l=[];r.forEach((function(e){e.action==t?a.push({userID:e.idName,userName:e.nickName,role:e.role}):e.action==o&&l.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList&&(this.userList=this.userList.concat(a).filter((function(e){return!l.some((function(t){return t.userID==e.userID}))}))),0!==a.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"ADD",a),0!==l.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"DELETE",l),this.logger.info(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(n.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},e.prototype.onUserStateUpdate=function(e,t,o){var r=this,i=s.getReportSeq();this.dataReport.newReport(i,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var n=o.filter((function(e){return e.userID!==r.stateCenter.idName}));0!=n.length&&("PRIVATE"!==this.stateCenter.type&&(n=n.map((function(e){return{userID:e.userID,userName:e.userName}}))),this.stateCenter.actionListener("roomUserUpdate",e,t,n),this.dataReport.addMsgInfo(i,{user_update_type:"ADD"==t?a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("added"):a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("deleted")}),this.dataReport.uploadReport(i))},e.prototype.mergeUserByUserSeq=function(e,t){var o=this;this.userSeqMergeMap||(this.logger.warn(n.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){o.handleMergeTimeout()}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(n.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},e.prototype.mergeUser=function(e){var t=this;this.logger.info(n.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval;var o={};e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){o[e.IdName]=e}))})),this.userSeqMergeMap=null;var r=Object.values(o).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}}));r.sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)}));var s=[],i=[];r.forEach((function(e){1==e.action?s.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&i.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList=this.userList&&this.userList.concat(s).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))})),0!==s.length&&this.onUserStateUpdate(this.room.roomID,"ADD",s),0!==i.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",i),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,r)},e.prototype.handleMergeTimeout=function(){var e=this,t=Object.keys(this.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));if(t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.minUserSeq)this.mergeUser(t);else{this.userSeqMergeMap=null;var o=this.lastUserQueryTime-Date.now();this.logger.info(n.ZEGO_RTM_ACTION.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+t.join(",")+" wait "+o),o>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){e.fetchUserList()}),o)):this.fetchUserList()}},e.prototype.loginPrivateRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},e.prototype.handleFetchUserListPrivateRsp=function(e){if(this.logger.debug(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" call"),e.body.code&&0!==e.body.code)return this.userQuerying=!1,void this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" fetch error "+e.body.code+" "+e.body.message);if(this.stateCenter.userStateUpdate){this.userTempList=r(r([],this.userTempList),e.body.users),this.userSeq=e.body.userlist_seq,this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" set user Seq "+this.userSeq);for(var t=[],o=0;o<this.userTempList.length;o++){var s={userID:this.userTempList[o].user_id,userName:this.userTempList[o].user_name,role:this.userTempList[o].role};t.push(s)}this.userQuerying=!1,this.onUserStateUpdate(this.room.roomID,"ADD",t),this.userTempList=[],this.logger.info(n.ZEGO_RTM_ACTION.USER_FETCH_USER+" call success user_list "+t+" count "+t.length)}},e}();t.UserHandler=l},function(e,t,o){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__spreadArray||function(e,t){for(var o=0,r=t.length,s=e.length;o<r;o++,s++)e[s]=t[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomService=void 0;var i=o(0),n=o(11),a=o(2),l=o(1),g=function(){function e(e,t){this.stateCenter=e,this.logger=t,this.service=new n.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return e.prototype.checkResponse=function(e){return e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid},e.prototype.handleSendCommandMsgRsp=function(e){var t=this,o=this.service.sendCommandMap[e.header.seq];if(null!=o){var r=o._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(o),0===e.body.err_code?setTimeout((function(){r&&null!=r.success&&r.success(e,t.cmdSeq)}),0):setTimeout((function(){r&&null!=r.error&&r.error(e,t.cmdSeq)}),0)}},e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg type error ")}},e.prototype.handlePushKickout=function(e){var t,o,r,i;if((null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.protocol)&&1!=(null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.protocol)){var n=null===(r=null==e?void 0:e.header)||void 0===r?void 0:r.room_id,l=this.stateCenter.roomModulesList.find((function(e){return e.roomID==n}));if(!l)return void this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(null===(i=e.header)||void 0===i?void 0:i.room_id));l.roomHandler.handlePushKickout(e)}else s([],this.stateCenter.roomModulesList).forEach((function(t){return t.roomHandler.handlePushKickout(e,!0)}))},e.prototype.handlePushCustomMsg=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.messageHandler.handlePushCustomMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushRoomMsg=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.messageHandler.handlePushRoomMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushUserStateUpdateMsg=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.userHandler.handlePushUserStateUpdateMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushMergeMsg=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.messageHandler.handlePushMergeMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushTransMsg=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.messageHandler.handlePushTransMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handleBigImMsgRsp=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.messageHandler.handleBigImMsgRsp(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushSignalMsg=function(e){var t,o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==o}));r?r.liveHandler.handlePushSignalMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.closeHandler=function(e){this.service.closeHandler(e)},e.prototype.openHandler=function(e){this.service.openHandler(e)},e.prototype.errorHandler=function(e){this.service.errorHandler(e)},e.prototype.getHeader=function(e,t,o,r){return{Protocol:"V1"===i.ROOMVERSION?"req":"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:o||"",room_session_id:r||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.startCheck=function(){this.service.startCheck()},e.prototype.stopCheck=function(){this.service.stopCheck()},e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=r(r({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}})},e.prototype.closeSocket=function(){this.service.closeSocket()},e.prototype.sendMessage=function(e,t,o,r,s,i){var n,g,d;if(this.service.isDisConnect())return this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),r(l.errorCodeList.SOCKET_CLOSE),0;var _=(null==i?void 0:i.roomID)?i.roomID:null===(n=this.stateCenter.roomModulesList[0])||void 0===n?void 0:n.roomID,u=(null==i?void 0:i.roomSessionID)?i.roomSessionID:null===(g=this.stateCenter.roomModulesList[0])||void 0===g?void 0:g.roomSessionID,c=(null==i?void 0:i.sessionID)?i.sessionID:null===(d=this.stateCenter.roomModulesList[0])||void 0===d?void 0:d.sessionID,h=s||this.getHeader(e,c,_,u);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:h,body:t})),this.service.sendMessage(h,t,o,r)},e.prototype.on=function(e,t){this.responseRouters[e]=t},e.prototype.login=function(e,t,o){var r=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID),s={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?i.E_CLIENT_TYPE.ClientType_Webrtc:i.E_CLIENT_TYPE.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",s,t,o,r)},e.prototype.logout=function(e,t,o){var r=e.isMulti?"quit":"logout",s={reserve:0};return"logout"==r&&(s.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(r,s,t,o,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},e.prototype.heartBeat=function(e,t,o,r,s){return this.sendMessage("hb",{reserve:0},e,t,void 0,{sessionID:o,roomID:r,roomSessionID:s})},e.prototype.fetchUserList=function(e,t,o,r,s,i){return this.sendMessage("user_list",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.fetchUserListV2=function(e,t,o,r,s,i){return this.sendMessage("user_list_v2",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.fetchReliableMessage=function(e,t,o,r,s,i){return this.sendMessage("trans_fetch",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendReliableMessage=function(e,t,o,r,s,i){return this.sendMessage("trans",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendRoomMsg=function(e,t,o,r,s,i){return this.sendMessage("im_chat",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendCustomCommand=function(e,t,o,r,s,i){return this.sendMessage("custommsg",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendBigRoomMessage=function(e,t,o,r,s,i){return this.sendMessage("bigim_chat",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendRelayMessage=function(e,t,o,r,s,i){return this.sendMessage("relay",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendSignalCmd=function(e,t,o,r,s,i){return this.sendMessage("signal",e,t,o,void 0,{sessionID:r,roomID:s,roomSessionID:i})},e.prototype.sendPB=function(e){return this.service.isDisConnect()?(this.logger.error(a.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(e)},e}();t.LiveRoomService=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0;var r=o(0),s=o(1),i=function(){function e(e){this.socket=null,this.sendCommandList=new r.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}return e.prototype.createSocket=function(e){this.socket=r.createZegoWebSocket(e,this.ENV%2)},e.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},e.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},e.prototype.sendMessage=function(e,t,o,r,s){void 0===o&&(o=null),void 0===r&&(r=null),void 0===s&&(s={timeOut:6e3});var i={header:e,body:t},n={data:i,seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:s.timeOut,success:o,error:r},a=this.sendCommandList.push(n);return this.sendCommandMap[n.seq]=a,this.socket&&this.socket.send(JSON.stringify(i)),e.seq},e.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(s.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg)}),0),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var o=e.getFirst(),r=Date.parse(new Date+""),i=0;!(null==o||o._data&&o._data.sendTime+o._data.timeOut>r||(o._data&&delete t[o._data.data.header.seq],e.remove(o),o._data&&null==o._data.error||o._data&&o._data.sendTime+this.sendDataDropTimeout<r?0:setTimeout((function(){o&&o._data&&o._data.error&&o._data.error(s.errorCodeList.TIMEOUT,o._data.data.header.seq,o._data.data.body.custom_msg)}),0),++i>=this.sendDataCheckOnceCount));)o=e.getFirst()},e.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},e.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},e.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(o){t.socket.binaryType="arraybuffer",t.responseHandler(),e(o)})},e.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){var o="string"==typeof t.data?JSON.parse(t.data):t.data;e.onMessage(o)})},e.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},e.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},e.prototype.onMessage=function(e){},e}();t.ZegoSocketService=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.getSeq=t.getReportSeq=t.ZegoExpressWebRTMEngine=void 0;var r=o(13);Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return r.ZegoExpressWebRTM}});var s=o(0),i=function(){function e(t,o,i){void 0===i&&(i=0),this.logger=new s.ZegoLogger(i),this.dataReport=new s.ZegoDataReport(this.logger),this.zegoWebRTM=new r.ZegoExpressWebRTM(t,o,this.logger,this.dataReport,e.version,i)}return e.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},e.prototype.loginRoom=function(e,t,o,r){return this.zegoWebRTM.loginRoom(e,t,o,r)},e.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},e.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,o){return this.zegoWebRTM.sendCustomCommand(e,t,o)},e.prototype.setRoomExtraInfo=function(e,t,o){return this.zegoWebRTM.setRoomExtraInfo(e,t,o)},e.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},e.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},e.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},e.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},e.prototype.loginHall=function(e,t,o){return this.zegoWebRTM.loginHall(e,t,o)},e.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},e.prototype.enterRoom=function(e,t){return this.zegoWebRTM.enterRoom(e,t)},e.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},e.version=s.PROTO_VERSION,e}();t.ZegoExpressWebRTMEngine=i;var n=o(0);Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return n.getReportSeq}}),Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return n.getSeq}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}})},function(e,t,o){"use strict";var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,i){function n(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var o,r,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,r=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(s=n.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__spreadArray||function(e,t){for(var o=0,r=t.length,s=e.length;o<r;o++,s++)e[s]=t[o];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=void 0;var n=o(0),a=o(1),l=o(3),g=o(0),d=o(16),_=o(17),u=o(18),c=o(19),h=o(21),R=o(2),m=o(4),E=o(24),T=o(10),p=o(25),M=function(){function e(e,t,o,r,s,i){this.logger=o,this.dataReport=r,this.version=s,this.stateCenter=new u.StateCenter(this.logger,this.dataReport),this.stateCenter.ENV=i;var a=g.getReportSeq();if(this.dataReport.newReport(a),(0==i||1==i)&&this.setDebug(t),l.ClientUtil.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,0==i||1==i?("string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&t.length>0&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.service=new T.LiveRoomService(this.stateCenter,this.logger)):2!=i&&3!=i||(this.service=new p.LiveRoomPrivateService(this.stateCenter,this.logger),this.module=new h.LiveRoomModules(this.stateCenter,this.logger,this.dataReport,this.service),this.stateCenter.priModules=this.module,this.module.dispatchServer=t,this.stateCenter.type="PRIVATE"),0==i||2==i)this.bindWindowListener(),this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?n.ENUM_NETWORK_STATE.online:n.ENUM_NETWORK_STATE.offline:n.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(a,{system_info:m.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(1==i||3==i){this.bindWxListener();try{var d=wx.getSystemInfoSync(),_={brand:d.brand,model:d.model,system:d.system,platform:d.platform,version:d.version,SDKVersion:d.SDKVersion};this.dataReport.addMsgInfo(a,{system_info:_})}catch(e){this.logger.warn(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(a,m.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(a,m.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return Object.defineProperty(e.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),o=l.ClientUtil.getBrowser(),r=t?"pagehide":"Firefox"===o?"beforeunload":"unload";window.addEventListener(r,(function(){e.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+r),"PUBLIC"===e.stateCenter.type?e.logoutRoom():(e.leaveRoom(),e.logoutHall()),e.logoutRoom()})),window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},e.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},e.prototype.netOnLineHandle=function(){var e=this;this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+"network is online"),this.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))}))},e.prototype.netOffLineHandle=function(){this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=n.ENUM_NETWORK_STATE.offline,this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.onactive=function(t,o){e.roomHandler.disconnectedHandle(o)},e.roomTryHandler.startMaxTime(),e.roomHandler.roomStateHandle("CONNECTING",a.errorCodeList.NETWORK_BROKEN))}))},e.prototype.setLogConfig=function(e){this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var t=g.getReportSeq();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:m.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&(this.logger.setRemoteLogLevel(e.remoteLogLevel),this.dataReport.addMsgInfo(t,{remote_log_level:m.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)})),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:m.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},e.prototype.setDebugVerbose=function(e){var t=g.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:m.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},e.prototype.setDebug=function(e){"string"==typeof e&&e.indexOf("wss")>-1?this.stateCenter.debug=l.ClientUtil.isTestEnv(e):Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"==typeof e&&e.indexOf("wss")>-1}))?this.stateCenter.debug=l.ClientUtil.isTestEnv(e[0])||l.ClientUtil.isTestEnv(e[1]):this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},e.prototype.renewToken=function(e,t){var o,r=g.getReportSeq();if(this.dataReport.newReport(r),void 0!==t&&("string"!=typeof t||""==t))return this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var s=this.getRoomModules(t)||this.stateCenter.roomModulesList[0];return s?"string"==typeof e&&s.roomTryHandler?(null===(o=s.roomTryHandler)||void 0===o||o.renewToken(e),this.dataReport.uploadReport(r,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!0):"string"!=typeof e||s.roomTryHandler?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(r,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"}),this.dataReport.uploadReport(r,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(r,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(r,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(r,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(r,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1)},e.prototype.loginRoom=function(e,t,o,a){var l=this;return new Promise((function(g,u){return r(l,void 0,void 0,(function(){var r,l,h,E,T,p=this;return s(this,(function(s){switch(s.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){wx.getNetworkType({success:function(t){p.stateCenter.networkState="none"===t.networkType?n.ENUM_NETWORK_STATE.offline:n.ENUM_NETWORK_STATE.online,e()},fail:function(t){p.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(t)),p.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,e()}})}))];case 1:s.sent(),s.label=2;case 2:return r=this.loginReport(g,u,t,a),l=r.interResolve,h=r.interReject,!(a=a||{}).maxMemberCount&&(a.maxMemberCount=0),(E=_.checkParams({roomID:{order:0,value:e,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:_.RULE_PARAM_NAME.MAX_LENGTH_128,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:_.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:o,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:_.RULE_PARAM_NAME.TYPE_OBJECT,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:o.userID,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:_.RULE_PARAM_NAME.MAX_LENGTH_100,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:_.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:o.userName,rules:[{name:_.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:_.RULE_PARAM_NAME.MAX_LENGTH_256,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:a,rules:[]},"config.maxMemberCount":{order:6,value:a.maxMemberCount,rules:[{name:_.RULE_PARAM_NAME.TYPE_INTEGER,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:this.logger}))!==_.RULE_SUCCESS?(h(E.error,E.extMsg),[2]):(T=this.getRoomModules(e))?(h(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN),[2]):(T=new c.LiveRoomModules(e,this.stateCenter,this.logger,this.dataReport,this.service),this.stateCenter.roomModulesList.length>0&&1==this.stateCenter.isMultiRoom?T.isMulti=!0:i([],this.stateCenter.roomModulesList).forEach((function(e){return e.roomHandler.logout()})),this.stateCenter.roomModulesList.push(T),T.roomTryHandler||(T.roomTryHandler=new d.RetryRoomHandler(this.logger,this.stateCenter,T)),T.roomTryHandler.init(this.stateCenter.roomRetryTime),T.roomTryHandler.initRoom(T.roomHandler,e,t,o,this.stateCenter.server,this.stateCenter.serverBak,a),T.roomTryHandler.setLoginRoomCallback(l,h),T.roomTryHandler.active(!0),this.stateCenter.setMultiRoom=!0,[2])}}))}))}))},e.prototype.loginReport=function(e,t,o,r){var s=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var i=g.getReportSeq();this.stateCenter.reportSeqList.login=i,this.dataReport.newReport(i,m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event),"string"==typeof o&&this.dataReport.addMsgInfo(i,{token:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(o),isMulti:this.stateCenter.isMultiRoom}),r&&(r.userUpdate&&"boolean"==typeof r.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(r.userUpdate+"")}),r.maxMemberCount&&"number"==typeof r.maxMemberCount&&this.dataReport.addMsgInfo(i,{max_member_count:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(r.maxMemberCount+"")})),l.ClientUtil.logReportCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,i,this.stateCenter.reportList);return{interResolve:function(t){s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,s.stateCenter.reportList),e(t)},interReject:function(e,o){var r,n;void 0===o&&(o=""),e.code<2e9&&e.code>1e9||e.code<1e6?(r=l.ClientUtil.decodeServerError(e.code,e.msg),n=l.ClientUtil.getLiveRoomError(e.code)):r={code:e.code,message:e.msg},r&&s.dataReport.addMsgInfo(i,{error:r.code,message:r.message+o}),s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,s.stateCenter.reportList),n&&a.errorCodeList[n]&&(e.code=a.errorCodeList[n].code),e.code&&e.msg&&""!==o?t({code:e.code,msg:e.msg+o}):t(e)}}},e.prototype.logoutRoom=function(e){var t=g.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e,isMulti:this.stateCenter.isMultiRoom}),void 0===e)i([],this.stateCenter.roomModulesList).forEach((function(e){return e.roomHandler.logout(!0)}));else{if("string"!=typeof e||""==e)return this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);var o=this.getRoomModules(e);o?(o.roomHandler.logout(),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)):(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(t,{error:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg}),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event))}},e.prototype.loginHall=function(e,t,o){var i=this;return new Promise((function(a,l){return r(i,void 0,void 0,(function(){var r,i,g,d,_=this;return s(this,(function(s){switch(s.label){case 0:return 3!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){wx.getNetworkType({success:function(t){_.stateCenter.networkState="none"===t.networkType?n.ENUM_NETWORK_STATE.offline:n.ENUM_NETWORK_STATE.online,e()},fail:function(t){_.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" network "+JSON.stringify(t)),_.stateCenter.networkState=n.ENUM_NETWORK_STATE.online,e()}})}))];case 1:s.sent(),s.label=2;case 2:return r=this.loginHallReport(a,l,e,o),i=r.interResolve,g=r.interReject,o=o||{},"string"!=typeof e||""==e?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" token format error"),g(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM,"token format error"),[2]):"object"!=typeof t||"string"!=typeof t.userID||"string"!=typeof t.userName?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" user error"),g(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," user error"),[2]):"object"!=typeof o||"string"!=typeof o.deviceID?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" deviceID error"),g(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," deviceID error"),[2]):"object"!=typeof o||"string"!=typeof o.deviceType?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" deviceType error"),g(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," deviceType error"),[2]):"object"!=typeof o||1!==o.anType&&0!==o.anType?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+" anType error"),g(m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.INPUT_PARAM," anType error"),[2]):((d=this.module).hallToken=e,d.deviceID=o.deviceID,d.deviceType=o.deviceType,d.anType=o.anType,this.stateCenter.idName=t.userID,this.stateCenter.nickName=t.userName||t.userID,this.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_HALL+JSON.stringify(o)),o&&"boolean"==typeof o.roomFlag&&(o.roomFlag?d.roomFlag=1:d.roomFlag=0),o&&"boolean"==typeof o.testEnvironment&&(this.stateCenter.testEnvironment=o.testEnvironment),o&&"boolean"==typeof o.userUpdate&&(this.stateCenter.userStateUpdate=o.userUpdate),d.hallRunState!==n.ENUM_RUN_STATE.logout&&(d.hallHandler.resetHall(),d.hallHandler.hallStateHandle("DISCONNECTED",m.ZegoRTMLogEvent.kZegoTaskLoginHall.error.REPEATEDLY_LOGIN),d.setRoomRunState(n.ENUM_RUN_STATE.logout),d.roomPrivateHandler.resetRoom()),this.dispatchServer((function(){d.retryHallHandler||(d.retryHallHandler=new E.RetryHallHandler(_.logger,_.stateCenter,_.module)),d.retryHallHandler.init(_.stateCenter.roomRetryTime),d.retryHallHandler.initRoom(_.module.hallHandler,t,_.stateCenter.server,o),d.retryHallHandler.onactive=function(e,t){e?i(e):g(t)},d.retryHallHandler.active(!0)})),[2])}}))}))}))},e.prototype.loginHallReport=function(e,t,o,r){var s=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList));var i=g.getReportSeq();this.stateCenter.reportSeqList.login=i,this.dataReport.newReport(i,m.ZegoRTMLogEvent.kZegoTaskLoginHall.event),"string"==typeof o&&this.dataReport.addMsgInfo(i,{token:m.ZegoRTMLogEvent.kZegoTaskLoginHall.token(o)}),r&&(r.userUpdate&&"boolean"==typeof r.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.user_update(r.userUpdate+"")}),r.deviceID&&"string"==typeof r.deviceID&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.device_id(r.deviceID)}),r.deviceType&&"string"==typeof r.deviceType&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.device_type(r.deviceType)}),r.anType&&"number"==typeof r.anType&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.an_type(r.anType+"")}),r.roomFlag&&"boolean"==typeof r.roomFlag&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.room_flag(r.roomFlag+"")}),r.testEnvironment&&"boolean"==typeof r.testEnvironment&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginHall.test_environment(r.testEnvironment+"")})),l.ClientUtil.logReportCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.dataReport,i,this.stateCenter.reportList);return{interResolve:function(t){s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,s.stateCenter.reportList),e(t)},interReject:function(e,o){void 0===o&&(o=""),s.dataReport.addMsgInfo(i,{error:e.code,message:e.msg+o}),s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,l.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,s.stateCenter.reportList),t({code:e.code,msg:e.msg+o})}}},e.prototype.logoutHall=function(){var e=g.getReportSeq();this.dataReport.newReport(e),this.module.hallHandler.logout(),this.module.setRoomRunState(n.ENUM_RUN_STATE.logout),this.module.roomPrivateHandler.resetRoom(),this.dataReport.uploadReport(e,m.ZegoRTMLogEvent.kZegoTaskLogoutHall.event)},e.prototype.enterRoom=function(e,t){var o=this;return new Promise((function(r,s){var i=g.getReportSeq();if(o.dataReport.newReport(i),"string"!=typeof e||""==e||![0,1].includes(t))return o.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" param error"),void r({errorCode:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.INPUT_PARAM.code,extendedData:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.INPUT_PARAM.msg});var a=o.module;if(!a.isLogin())return o.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" no login hall before entering room"),void r({errorCode:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.NOT_LOGIN.code,extendedData:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.NOT_LOGIN.msg});a.runRoomState!==n.ENUM_RUN_STATE.logout&&(o.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+" reset"),o.module.roomPrivateHandler.resetRoom(),o.module.roomPrivateHandler.roomStateHandle("DISCONNECTED",m.ZegoRTMLogEvent.kZegoTaskEnterRoom.error.REPEATEDLY_ENTER_ROOM)),a.pri_roomID=e,o.stateCenter.role=t,o.dataReport.addMsgInfo(i,{role:m.ZegoRTMLogEvent.kZegoTaskEnterRoom.role(t+"")}),a.setRoomRunState(n.ENUM_RUN_STATE.trylogin),a.roomPrivateHandler.roomStateHandle("CONNECTING",{code:0,msg:""});var l=function(t,l){if(t.body&&0!==t.body.code||1100002==t.code){a.setRoomRunState(n.ENUM_RUN_STATE.logout);var g=t.body&&t.body.code||t.code,d=t.body&&t.body.message||t.msg;a.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:g,msg:d}),o.dataReport.addMsgInfo(i,{error:g,message:d}),o.dataReport.uploadReport(i,m.ZegoRTMLogEvent.kZegoTaskEnterRoom.event),s({errorCode:g,extendedData:d})}else a.roomID=e,a.timeStamp=t.header.timeStamp,a.roomSid=t.body.room_header.room_sid,a.roomSessionID=t.body.room_header.room_user_session_id,a.userSeq=t.body.userlist_seq,o.dataReport.uploadReport(i,m.ZegoRTMLogEvent.kZegoTaskEnterRoom.event),a.setRoomRunState(n.ENUM_RUN_STATE.login),a.roomPrivateHandler.roomStateHandle("CONNECTED",{code:0,msg:""}),o.module.userHandler.loginPrivateRsp(t),a.roomLoginResponse(t),r({errorCode:0,extendedData:""})};setTimeout((function(){a.roomPrivateHandler.enterRoom(l,l)}),20)}))},e.prototype.leaveRoom=function(){var e=this;return new Promise((function(t){var o=g.getReportSeq();e.dataReport.newReport(o),e.module.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:0,msg:""});var r=function(r,s){0!==r.body.code?(e.dataReport.addMsgInfo(o,{error:r.body.code,message:r.body.message}),e.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskLeaveRoom.event),t({errorCode:r.body.code,extendedData:r.body.message})):(e.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskLeaveRoom.event),t({errorCode:0,extendedData:""}))};e.module.roomPrivateHandler.leaveRoom(r,r)}))},e.prototype.sendCustomCommand=function(e,t,o){var r=this;return new Promise((function(s,i){r._sendCustomCommand(e,t,o).then((function(e){s({errorCode:e.errorCode,extendedData:e.extendedData})})).catch((function(e){i(e)}))}))},e.prototype._sendCustomCommand=function(e,t,o){var r=this;return new Promise((function(s,i){var d=g.getReportSeq();r.dataReport.newReport(d,m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.event);var _=l.ClientUtil.proxyRes(r.dataReport,d,s,i),u=_.interResolve,c=_.interReject;if("string"!=typeof e||""==e)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" roomid must be string and not empty"),void c(a.errorCodeList.INPUT_PARAM," param roomID error");if(!(o instanceof Array)||o.find((function(e){return"string"!=typeof e})))return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" dstMembers must be string array"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error");if("PUBLIC"===r.stateCenter.type&&"string"!=typeof t&&"object"!=typeof t)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("PRIVATE"===r.stateCenter.type&&"string"!=typeof t)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a not empty string"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("string"==typeof t&&t.length>n.MAX_MESSAGE_LENGTH)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" command too long"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG);var h=r.getRoomModules(e);h?(r.dataReport.addMsgInfo(d,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.room_sid(h.sessionID)}),h.messageHandler.sendCustomCommand(o,t,u,c)):c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.ROOM_NOT_EXIST)}))},e.prototype.sendBroadcastMessage=function(e,t){var o=this;return new Promise((function(r,s){o._sendBroadcastMessage(e,t).then((function(e){r({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){s(e)}))}))},e.prototype._sendBroadcastMessage=function(e,t,o,r){var s=this;return void 0===o&&(o=1),void 0===r&&(r=1),new Promise((function(i,a){var d=g.getReportSeq();s.dataReport.newReport(d,m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.event);var _=l.ClientUtil.proxyRes(s.dataReport,d,i,a),u=_.interResolve,c=_.interReject;if("string"!=typeof e||""==e)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message is empty"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL);if("string"!=typeof t)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message must be string"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error");if(t.length>n.MAX_MESSAGE_LENGTH)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message too long"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG);var h=s.getRoomModules(e);h?(s.dataReport.addMsgInfo(d,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.room_sid(h.sessionID)}),h.messageHandler.sendRoomMsg(o,r,e,t,u,c)):c(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.ROOM_NOT_EXIST)}))},e.prototype.setRoomExtraInfo=function(e,t,o){return this._setRoomExtraInfo(e,t,o)},e.prototype._setRoomExtraInfo=function(e,t,o){var r=this;return new Promise((function(s,i){var a=g.getReportSeq();r.dataReport.newReport(a,m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.event);var d=l.ClientUtil.proxyRes(r.dataReport,a,s,i),_=d.interResolve,u=d.interReject;if("string"!=typeof e||""==e)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void u(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(!t||"string"!=typeof t)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type must be string"),void u({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(t.length>n.MAX_TRANS_TYPE_LENGTH)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void u({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(!o||"string"!=typeof o)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" data must be string"),void u({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(o.length>n.MAX_TRANS_DATA_LENGTH)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void u({errorCode:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});var c=r.getRoomModules(e);c?(r.dataReport.addMsgInfo(a,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.room_sid(c.sessionID)}),c.messageHandler.sendReliableMessage(t,o,_,u)):u(m.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.ROOM_NOT_EXIST)}))},e.prototype.sendBarrageMessage=function(e,t){var o=this;return new Promise((function(r,s){o._sendBarrageMessage(e,t).then((function(e){r({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){s(e)}))}))},e.prototype._sendBarrageMessage=function(e,t,o,r){var s=this;return void 0===o&&(o=1),void 0===r&&(r=1),new Promise((function(i,a){var d=g.getReportSeq();s.dataReport.newReport(d,m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.event);var _=l.ClientUtil.proxyRes(s.dataReport,d,i,a),u=_.interResolve,c=_.interReject;if("string"!=typeof e||""==e)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+"roomid must be string and not empty"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message is empty"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL);if("string"!=typeof t)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message must be string"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error");if(t.length>n.MAX_MESSAGE_LENGTH)return s.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message too long"),void c(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG);var h=s.getRoomModules(e);h?(s.dataReport.addMsgInfo(d,{room_sid:m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.room_sid(h.sessionID)}),h.messageHandler.sendBigRoomMessage(o,r,e,t,u,c)):c(m.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.ROOM_NOT_EXIST)}))},e.prototype.sendRelayMessage=function(e,t,o,r,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];i?i.messageHandler.sendRelayMessage(e,t,o,r):r&&r(a.errorCodeList.ROOM_NOT_EXIST,0)},e.prototype.requestJoinLive=function(e,t,o,r,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.requestJoinLive(e,t,o,r):(o&&o(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.inviteJoinLive=function(e,t,o,r,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.inviteJoinLive(e,t,o,r):(o&&o(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.endJoinLive=function(e,t,o,r){var s=this.getRoomModules(r)||this.stateCenter.roomModulesList[0];return s?s.liveHandler.endJoinLive(e,t,o):(o&&o(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.respondJoinLive=function(e,t,o,r,s){var i=this.getRoomModules(s)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.respondJoinLive(e,t,o,r):(r&&r(a.errorCodeList.ROOM_NOT_EXIST,0),!1)},e.prototype.getVersion=function(){return this.version},e.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},e.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var o=this.stateCenter.listenerList[e];return t?o.splice(o.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var o=this.stateCenter.listenerList[e];return t?o.splice(o.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},e.prototype.isLogin=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return!!t&&t.isLogin()},e.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},e.prototype.getAppID=function(){return this.stateCenter.appid},e.prototype.getUserID=function(){return this.stateCenter.idName},e.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},e.prototype.getAnType=function(){return this.module.anType},e.prototype.getRoomSid=function(){return this.module.roomSid},e.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},e.prototype.setRole=function(e){this.stateCenter.role=e},e.prototype.getSessionId=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.sessionID:"0"},e.prototype.getRoomSessionID=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.roomSessionID:"0"},e.prototype.enableMultiRoom=function(e){var t=g.getReportSeq();return this.dataReport.newReport(t,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(t,{isMulti:e}),"boolean"!=typeof e?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(t,void 0,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):this.stateCenter.roomModulesList.length>0||this.stateCenter.setMultiRoom?(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(t,void 0,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(t),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0,!0)},e.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find((function(t){return t.roomID==e}))},e.prototype.dispatchServer=function(e){var t=this;this.logger.info("zc.hh.dc call");var o=this.dispatchBodyData(),r=this.module.dispatchServer;if(l.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList)&&l.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,m.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.dispatch_connection.event),XMLHttpRequest){var s=new XMLHttpRequest;s.open("POST",r),s.setRequestHeader("Content-type","application/json; charset=utf-8"),s.onreadystatechange=function(){if(200==s.status&&4==s.readyState&&s.responseText&&""!==s.responseText){var o=JSON.parse(s.responseText);o.server_addrs&&0!==o.server_addrs.length&&(t.stateCenter.server=o.server_addrs[0].replace(":443",""),t.module.sessionExpire=o.session_expire+"",l.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,t.stateCenter.reportList)&&l.ClientUtil.actionSuccessCallback(m.ZegoRTMLogEvent.kZegoTaskLoginHall.event,t.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,m.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.dispatch_connection.event,{server:t.stateCenter.server,session_expire:t.module.sessionExpire}),e&&e())}},s.send(JSON.stringify(o))}else wx.request({url:r,header:{"Content-Type":"application/json"},method:"POST",data:JSON.stringify(o),dataType:"json",success:function(o){o.data.server_addrs&&0!==o.data.server_addrs.length&&(t.stateCenter.server=o.data.server_addrs[0].replace(":443",""),t.module.sessionExpire=o.data.session_expire+"",e&&e())},fail:function(e){console.error("send failed "+e.statusCode)}})},e.prototype.dispatchBodyData=function(){return{seq:1,timestamp:(new Date).getTime,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,user_name:this.stateCenter.nickName,net_type:2,device_id:this.module.deviceID,login_token:this.module.hallToken,an_type:this.module.anType}},e.prototype.getRoomBroadcastMessages=function(e,t){var o=this;return new Promise((function(r,s){o.module.messageHandler.getRoomChatInfo(e,t,r,s)}))},e.prototype.sendCustomMessage=function(e,t,o){var r=this;return new Promise((function(s){if(e&&"string"==typeof e&&0===e.length)if(t&&"string"==typeof t)if(o)if(r.module.isLogin()){var i=function(e){if(e.body.code&&0!==e.body.code)return r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" server error=",e.body.code),void s(e);s(e),r.logger.info(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" call success.")};r.module.service.sendMessage(e,o,i,i)}else r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" hallState is not login");else r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" rsbodyDatapCmd error");else r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" rspCmd error");else r.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM_MESSAGE+" reqCmd error")}))},e.prototype.getQueueSimpleList=function(){var e=this;return new Promise((function(t,o){e.sendCustomMessage("zegochat_js.queue_list_req","zegochat_js.queue_list_rsp",{}).then((function(r){r.body.code&&0!==r.body.code?(e.logger.error("zc.gqs.0 get list error, code = "+r.body.code),o({errorCode:r.body.code,extendData:r.body.message})):t({queues:r.body.queues})}))}))},e.prototype.setProtoFormat=function(e){if(void 0===e&&(e="json"),!["json","pb"].includes(e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},e.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},e.prototype.sendMessageByService=function(e,t,o,r,s,i){return this.service.sendMessage(e,t,o,r,s,i)},e.prototype.getHeader=function(e){var t=this.stateCenter.roomModulesList[0];if(t&&t.isLogin()){var o=t.roomID,r=t.sessionID,s=t.roomSessionID;return this.service.getHeader(e,r,o,s)}this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GET_HEADER+" room no found or no login")},e.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error(R.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" type error"),!1)},e.prototype.onPushBizChannel=function(e){e&&this.service.on("push_biz_channel",e)},e.prototype.getRoomID=function(){return this.stateCenter.roomid},e.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},e}();t.ZegoExpressWebRTM=M},function(e,t,o){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function o(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(r,s,function(t){return e[t]}.bind(null,s));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var r=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e,e.instance.init()),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var r=o(0),s=function(){function e(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWeiXinMiniWebSocket=s,t.createZegoWebSocket=function(e,t){return t%2===r.ZEGO_ENV.BROWSER?new WebSocket(e):new s(e)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var r=o(1);Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return r.LoggerStateCenter}});var s=o(2);Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}});var i=o(4);Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return i.ZegoDataReport}});var n=o(5);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}})},function(e,t,o){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0;var s=function(){function e(e){this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+" not exist")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,o){if(this.dataStatistics[e]){var r=this.dataStatistics[e].events;if(r&&0!==r.length){for(var s=r.length-1;s>=0;s--)if(r[s].event==t&&0==r[s].time_consumed){r[s].time_consumed=Date.now()-r[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t&&0==s[i].time_consumed){s[i].time_consumed=Date.now()-s[i].event_time,null==s[i].msg_ext&&(s[i].msg_ext={}),s[i].msg_ext=r({},o);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,o){if(this.dataStatistics[e]){var r=this.dataStatistics[e].events;if(r){for(var s=r.length-1;s>=0;s--)if(r[s].event==t&&0==r[s].time_consumed){r[s].time_consumed=Date.now()-r[s].event_time,Object.assign(r[s],o);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,o,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t&&null!=s[i].time_consumed){null==s[i].msg_ext?s[i].msg_ext={}:s[i].msg_ext&&(s[i].msg_ext[o]=r);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,o,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t){s[i][o]=r;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,o){this.dataStatistics[e]?this.dataStatistics[e].events&&(o?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:o}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,o,r){var s=this.dataStatistics[e];null!=s&&(t&&(s.event=t),s.time_consumed=Date.now()-s.event_time,o&&this.addMsgInfo(e,{error:o.code,message:o.message||o.msg+" "+(r||"")}),this.logger.report(s),delete this.dataStatistics[e])},e}();t.ZegoDataReport=s},function(e,t,o){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var s=o(0),i=o(2),n=o(1),a=o(6),l=function(){function e(e){this.logLevel=s.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=n.LoggerStateCenter.getInstance(),this.env=e}return e.prototype.setLogLevel=function(e){var t=s.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=s.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setSessionInfo=function(e,t,o,r,s,i){this.appid=e,this.roomid=t,this.sessionid=o,this.userid=r,this.userName=s,this.version=i},e.prototype.report=function(e){var t=this.logReportParamList(s.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.REPORT&&console.debug(t),this.RemoteLog(s.ENUM_LOG_LEVEL.REPORT,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.logParamList(s.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.DEBUG&&console.debug(o),this.log(s.ENUM_LOG_LEVEL.DEBUG,o)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.logParamList(s.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.INFO&&console.info(o),this.log(s.ENUM_LOG_LEVEL.INFO,o)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.logParamList(s.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.WARN&&console.warn(o),this.log(s.ENUM_LOG_LEVEL.WARN,o)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.logParamList(s.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.ERROR&&(console.error(o),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(s.ENUM_LOG_LEVEL.ERROR,o)},e.prototype.log=function(e,t){this.logRemoteLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=s.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=s.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=s.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},e.prototype.stopLogServer=function(){this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==s.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=s.ENUM_REMOTE_TYPE.DISABLE},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.RemoteLog=function(e,t,o){if(void 0===o&&(o=!1),""!=this.url)if(this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==s.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,o);else if(this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3)console.info("log over maximum, ignore");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var o=this.url;this.url="",this.setLogServer(o),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var s="",i=0;i<this.logCacheSend.length;i++){(s+this.logCacheSend[i]).length>4e3&&(this.websocket.send(s),s="");var n=JSON.parse(this.logCacheSend[i]);n=r(r({},n),{userid:n.userid||this.userid,roomid:n.roomid||this.roomid,userName:n.roomid||this.userName}),s=s+JSON.stringify(n)+"\n"}t=s+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,o){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===o)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,t){var o=a.getCurrentTime(),r=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t],s={time:o,level:e,action:r[0],content:r[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(s)},e.prototype.logReportParamList=function(e,t){var o=a.getCurrentTime();return t=r(r({},t),{time:o,level:e,console:this.env%2===s.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},e.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=i.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("onclose   websocket error:",e)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("open log websocket error:",e)}}},e.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env%2===s.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},e.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status){if(0==o.responseText.length)return;try{var t=JSON.parse(o.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){console.log("send result failed "+e)}}else console.log("send failed "+o.status)},o.open("POST",this.url,!0),0==this.env?o.send(t):2==this.env&&(o.setRequestHeader("content-type","application/json"),o.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCacheSend=[]},e.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach((function(t){Array.isArray(t)&&t.forEach((function(o,r){var s=JSON.parse(o);s&&""==JSON.parse(o).userid?(s.userid=e.userid,s.id_name=e.userid,t[r]=JSON.stringify(s)):e.existUserID=!0}))}));var t=this.logCacheSend.join("\n"),o=1==this.env?t:JSON.stringify({user_id:this.userid,log:t});wx.request({url:this.url,data:o,method:"POST",success:function(t){if(0!=t.data.length){var o=t&&t.data&&t.data.interval;"number"==typeof o&&e.logUploadInterval!==o&&(e.timeInterval=o,e.openHttpsLogServer(e.url))}},fail:function(e){console.log("send failed "+e.statusCode)}}),this.logCacheSend=[]},e}();t.ZegoLogger=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var r=o(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),o=-1!=e.indexOf("Firefox"),s=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?r.ZEGO_BROWSER_TYPE.IE:o?r.ZEGO_BROWSER_TYPE.FIREFOX:s?r.ZEGO_BROWSER_TYPE.OPERA:i?r.ZEGO_BROWSER_TYPE.CHROME:n?r.ZEGO_BROWSER_TYPE.SAFARI:a?r.ZEGO_BROWSER_TYPE.WEIXIN:r.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(r.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){e.miniprogram}))}))};var s=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(s[e.getMonth()+1]||e.getMonth()+1)+"/",(s[e.getDate()]||e.getDate())+" ",(s[e.getHours()]||e.getHours())+":",(s[e.getMinutes()]||e.getMinutes())+":",s[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}])},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0;var r=function(){function e(){}return e.base64encode=function(t){var o,r,s,i,n,a;for(s=t.length,r=0,o="";r<s;){if(i=255&t.charCodeAt(r++),r==s){o+=e.base64EncodeChars.charAt(i>>2),o+=e.base64EncodeChars.charAt((3&i)<<4),o+="==";break}if(n=t.charCodeAt(r++),r==s){o+=e.base64EncodeChars.charAt(i>>2),o+=e.base64EncodeChars.charAt((3&i)<<4|(240&n)>>4),o+=e.base64EncodeChars.charAt((15&n)<<2),o+="=";break}a=t.charCodeAt(r++),o+=e.base64EncodeChars.charAt(i>>2),o+=e.base64EncodeChars.charAt((3&i)<<4|(240&n)>>4),o+=e.base64EncodeChars.charAt((15&n)<<2|(192&a)>>6),o+=e.base64EncodeChars.charAt(63&a)}return o},e.base64decode=function(t){var o,r,s,i,n,a,l;for(a=t.length,n=0,l="";n<a;){do{o=e.base64DecodeChars[255&t.charCodeAt(n++)]}while(n<a&&-1==o);if(-1==o)break;do{r=e.base64DecodeChars[255&t.charCodeAt(n++)]}while(n<a&&-1==r);if(-1==r)break;l+=String.fromCharCode(o<<2|(48&r)>>4);do{if(61==(s=255&t.charCodeAt(n++)))return l;s=e.base64DecodeChars[s]}while(n<a&&-1==s);if(-1==s)break;l+=String.fromCharCode((15&r)<<4|(60&s)>>2);do{if(61==(i=255&t.charCodeAt(n++)))return l;i=e.base64DecodeChars[i]}while(n<a&&-1==i);if(-1==i)break;l+=String.fromCharCode((3&s)<<6|i)}return l},e.utf16to8=function(e){var t,o,r,s;for(t="",r=e.length,o=0;o<r;o++)(s=e.charCodeAt(o))>=1&&s<=127?t+=e.charAt(o):s>2047?(t+=String.fromCharCode(224|s>>12&15),t+=String.fromCharCode(128|s>>6&63),t+=String.fromCharCode(128|s>>0&63)):(t+=String.fromCharCode(192|s>>6&31),t+=String.fromCharCode(128|s>>0&63));return t},e.utf8to16=function(e){var t,o,r,s,i,n;for(t="",r=e.length,o=0;o<r;)switch((s=e.charCodeAt(o++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(o-1);break;case 12:case 13:i=e.charCodeAt(o++),t+=String.fromCharCode((31&s)<<6|63&i);break;case 14:i=e.charCodeAt(o++),n=e.charCodeAt(o++),t+=String.fromCharCode((15&s)<<12|(63&i)<<6|(63&n)<<0)}return t},e.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],e}();t.Base64=r},function(e,t,o){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryRoomHandler=void 0;var i=o(5),n=o(0),a=o(2),l=o(1),g=o(3),d=function(e){function t(t,o,r){var s=e.call(this,t,o)||this;return s.logger=t,s.stateCenter=o,s.room=r,s.loginRoomCallback={},s}return s(t,e),t.prototype.renewToken=function(e){if(this.token=e,this.room.token=this.token,"03"===e.substr(0,2)){var t=g.ClientUtil.decodeTokenExpire(e.substr(2));this.roomHandler.resetTokenTimer(1e3*t-(new Date).getTime()-this.stateCenter.local_time_deviation-3e4)}this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},t.prototype.initRoom=function(e,t,o,r,s,i,n){this.roomHandler=e,this.roomID=t,this.renewToken(o),this.user=r,this.server=s,this.serverBak=i||s,this.config=n},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(n.ENUM_RUN_STATE.trylogin),this.room.isMulti&&this.room.service.isDisConnect())this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry");else if(this.stateCenter.networkState!=n.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var o=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=o>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:o}this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,o){t.handleLoginFinish(!1,e,o)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,l.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(l.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail=void 0)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var o=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(o)&&(!!["1100040001","1100040100"].includes(o)||this.room.lastRunState==n.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},t.prototype.handleLoginFinish=function(e,t,o){t?this.handleError(t,o)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.loginRoomCallback.fail=void 0)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.loginRoomCallback.fail=void 0))},t}(i.TryHandler);t.RetryRoomHandler=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkParams=t.RULE_SUCCESS=t.RULE_PARAM_NAME=void 0;var r,s=o(3);!function(e){e.NOT_EMPTY="NOT_EMPTY",e.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",e.TYPE_STRING="TYPE_STRING",e.TYPE_INTEGER="TYPE_INTEGER",e.TYPE_OBJECT="TYPE_OBJECT",e.MAX_LENGTH_10="MAX_LENGTH_10",e.MAX_LENGTH_64="MAX_LENGTH_64",e.MAX_LENGTH_100="MAX_LENGTH_100",e.MAX_LENGTH_128="MAX_LENGTH_128",e.MAX_LENGTH_256="MAX_LENGTH_256",e.MAX_LENGTH_1024="MAX_LENGTH_1024"}(r=t.RULE_PARAM_NAME||(t.RULE_PARAM_NAME={})),t.RULE_SUCCESS={error:{code:0,msg:"suc"}};var i={NOT_EMPTY:function(e,o,r,s,i){return void 0===o||""===o||null===o?(s.error(r+" "+e+" is empty"),i):t.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(e,o,r,i,n){return s.ClientUtil.checkIllegalCharacters(o)?t.RULE_SUCCESS:(i.error(r+" "+e+" contains illegal characters"),n)},TYPE_STRING:function(e,o,r,s,i){return"string"!=typeof o?(s.error(r+" "+e+" must be string"),i):t.RULE_SUCCESS},TYPE_INTEGER:function(e,o,r,i,n){return s.ClientUtil.checkInteger(o,!1)?t.RULE_SUCCESS:(i.error(r+" "+e+"  must be integer number"),n)},TYPE_OBJECT:function(e,o,r,s,i){return o&&"object"==typeof o?t.RULE_SUCCESS:(s.error(r+" "+e+"  must be object"),i)},MAX_LENGTH_10:function(e,o,r,s,i){return o.length>10?(s.error(r+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_64:function(e,o,r,s,i){return o.length>64?(s.error(r+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_100:function(e,o,r,s,i){return o.length>100?(s.error(r+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_128:function(e,o,r,s,i){return o.length>128?(s.error(r+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_256:function(e,o,r,s,i){return o.length>256?(s.error(r+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_1024:function(e,o,r,s,i){return o.length>1024?(s.error(r+" "+e+" is too long"),i):t.RULE_SUCCESS}};t.checkParams=function(e,o){var s=[],n={};for(var a in e){n[e[a].order]=e[a],e[a].key=a}for(var l in n)s.push(n[l]);for(var g=0;g<s.length;g++)for(var d=s[g].rules,_=0;_<d.length;_++){var u={key:s[g].key,value:s[g].value,action:o.action,logger:o.logger},c=u.key,h=u.value,R=u.action,m=u.logger,E=d[_].name?""+d[_].name:"";if((void 0===h&&E===r.NOT_EMPTY||void 0!==h)&&i[E]){var T=i[E](c,h,R,m,d[_]);if(T!=t.RULE_SUCCESS)return T}}return t.RULE_SUCCESS}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var r=o(0),s=o(2),i=o(4),n=function(){function e(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=r.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this._sdkVersion="unknown"}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,r.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,r.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,r.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),e.prototype.getRequestId=function(){return this.idName+"-"+r.getSeq()},e.prototype.actionListener=function(e){for(var t=this,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];if(this.listenerList[e]){var a=r.getReportSeq();this.dataReport.newReport(a,i.ZegoRTMLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:o}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach((function(r){try{r.apply(void 0,o)}catch(o){t.logger.error(s.ZEGO_RTM_ACTION.STATE_ACTION+" ",e," ",JSON.stringify(o))}}))},Object.defineProperty(e.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),e}();t.StateCenter=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var r=o(0),s=o(6),i=o(7),n=o(8),a=o(20),l=o(9),g=function(){function e(e,t,o,g,d){this.roomID=e,this.stateCenter=t,this.logger=o,this.dataReport=g,this.service=d,this.runState=r.ENUM_RUN_STATE.logout,this.lastRunState=r.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.roomHandler=new a.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new s.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new l.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.messageHandler=new n.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.liveHandler=new i.LiveHandler(this.logger,this.stateCenter,this.service,this),this.init()}return e.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},e.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,o){e.heartBeatHandler.init(o),e.service.startCheck(),e.userHandler.loginRsp(o,t),e.messageHandler.loginRsp(o),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(o)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime(),e.roomTryHandler=void 0)}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.handleMultiRoom=function(){this.stateCenter.roomModulesList.forEach((function(e){e.runState!==r.ENUM_RUN_STATE.login&&e.roomTryHandler&&1==e.isMulti&&(e.roomTryHandler.onactive=function(t,o){o&&0!==o.code?e.roomHandler.roomStateHandle("DISCONNECTED",o):e.roomHandler.roomStateHandle("CONNECTED",o)},e.roomTryHandler.startMaxTime(),e.roomTryHandler.active())}))},e.prototype.isLogin=function(){return this.runState===r.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHandler=void 0;var r=o(0),s=o(3),i=o(2),n=o(1),a=o(4),l=function(){function e(e,t,o,r,s){this.logger=e,this.stateCenter=t,this.dataReport=o,this.service=r,this.room=s,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.loginCallback={}}return e.prototype.resetTokenTimer=function(e){var t=this;e=(e=e<0?0:e)>2147483648?2147483648:e,this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESETTOKEN_TIMER+"  call: "+e),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout((function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)}),e)},e.prototype.stopTokenTimer=function(){clearTimeout(this.tokenTimer)},e.prototype.setRunState=function(e){this.room.lastRunState=this.room.runState,this.room.runState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetRoom=function(e){var t=this;if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.stateCenter.roomModulesList.length>1&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.runState!==r.ENUM_RUN_STATE.logout&&!this.service.isDisConnect()){var o=function(e){t.handleLogoutRsp(e)};this.service.logout(this.room,o,o)}this.setRunState(r.ENUM_RUN_STATE.logout),this.room.sessionID="",this.room.roomSessionID="",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter((function(e){return e!==t.room}));var s=this.stateCenter.roomModulesList[0];s&&(s.isMulti=!1,s.runState!==r.ENUM_RUN_STATE.login&&s.roomTryHandler&&(s.roomTryHandler.startMaxTime(),s.roomTryHandler.active())),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handlePushKickout=function(e,t){var o=this;this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(e));var l=r.getReportSeq();this.dataReport.newReport(l,a.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(l,{user_id:a.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var g=s.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(l,{error:g.code,message:g.message}),this.dataReport.uploadReport(l);var d=this.room.roomTryHandler;if(d)if(d.onactive=function(e,t){o.disconnectedHandle(t),o.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin)this.room.sessionID="",d.startMaxTime(),d.active();else{this.resetRoom(t);var _={};e&&e.body.custom_reason?_.custom_kickout_message=e.body.custom_reason:g.name&&n.errorCodeList[g.name]&&(_.custom_kickout_message=n.errorCodeList[g.name].msg+" kickout，reason: "+e.body.reason),g.name&&n.errorCodeList[g.name]?this.disconnectedHandle(n.errorCodeList[g.name],JSON.stringify(_)):this.disconnectedHandle(n.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(_)),this.stateCenter.actionListener("_kickout",{code:n.errorCodeList.MANUAL_KICKOUT.code,msg:n.errorCodeList.MANUAL_KICKOUT.msg+e.body.reason})}else this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")},e.prototype.handleHbLogout=function(e){var t=this,o=this.room.roomTryHandler;o&&(o.onactive=function(e,o){t.disconnectedHandle(o)},[n.errorCodeList.HEARTBEAT_TIMEOUT,n.errorCodeList.SOCKET_CLOSE,n.errorCodeList.TIMEOUT].includes(e)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(o.startMaxTime(),o.active()):(o.stopMaxTime(),o.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(i.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var o=void 0;(o=e.code<2e9&&e.code>1e9||e.code<1e6?s.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:o.code,message:o.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,s.ClientUtil.unregisterCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var r=this.room.roomTryHandler;r?(r.onactive=function(e,o){o&&0!==o.code?t.roomStateHandle("DISCONNECTED",o):t.roomStateHandle("CONNECTED",o)},r.startMaxTime(),r.active()):this.logger.error(i.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",e,t)):this.roomStateHandle("CONNECTED",e,t)},e.prototype.roomStateHandle=function(e,t,o){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,o),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,o))},e.prototype.login=function(e,t,o,l,g,d,_){if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:",t,o),!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,t,"",l.userID,"",this.stateCenter.sdKVersion),g&&(g.userUpdate&&"boolean"==typeof g.userUpdate&&(this.stateCenter.userStateUpdate=g.userUpdate),g.maxMemberCount&&"number"==typeof g.maxMemberCount&&(this.stateCenter.maxMemberCount=g.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void _(n.errorCodeList.INIT);if(this.room.runState!==r.ENUM_RUN_STATE.trylogin&&this.setRunState(r.ENUM_RUN_STATE.trylogin),this.room.roomID=t,this.room.token=o,this.room.thirdToken=o,this.stateCenter.idName=l.userID,this.stateCenter.nickName=l.userName||l.userID,this.loginCallback.success=d,this.loginCallback.fail=_,0===this.stateCenter.reportSeqList.login){var u=r.getReportSeq();this.stateCenter.reportSeqList.relogin=u,this.dataReport.newReport(u,a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(u,{server:e}),s.ClientUtil.logReportCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,u,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLogin=function(e){var t=this;if(this.room.runState===r.ENUM_RUN_STATE.trylogin){var o=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)&&(this.tryLoginCount>1&&s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(r.REPORT_ACTION.eventEnd,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(r.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(r.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){t.openHandler()})),this.service.closeHandler((function(e){t.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)})),this.service.errorHandler((function(e){t.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(r.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var n=function(e,o){t.handleLoginRsp(e,o)};this.service.login(this.room,n,n)}this.tryLoginTimer=setTimeout((function(){t.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),t.loginCallback.fail&&t.loginCallback.fail(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(i.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(r.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(r.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var o=function(t,o){e.handleLoginRsp(t,o)};this.service.login(this.room,o,o)},e.prototype.handleLoginRsp=function(e,t){var o=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(r.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState===r.ENUM_RUN_STATE.trylogin)if(e.header&&e.body){if(e.header.seq!==t&&0==this.room.isMulti)return void this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq);0!==e.body.err_code?(this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(e))}else this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(e)),this.handleLoginFail(e);else this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INNER_ERROR;e.header&&e.body?t=s.ClientUtil.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},o=this.room.lastRunState;if(this.setRunState(r.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id,e.body.ret_timestamp&&"03"===this.room.token.substr(0,2)){var i=(new Date).getTime()-e.body.ret_timestamp;this.stateCenter.local_time_deviation=i<5e3?0:i;var n=s.ClientUtil.decodeTokenExpire(this.room.token.substr(2));this.resetTokenTimer(1e3*n-(new Date).getTime()-this.stateCenter.local_time_deviation-3e4)}!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),t.log_level=e.body.config_info.log_level,""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),t.log_url=e.body.config_info.log_url)),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var l=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;s.ClientUtil.actionSuccessCallback(l,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(l,this.stateCenter.reportList)(r.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(o,e),this.loginCallback.success&&this.loginCallback.success(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code?e.code:e)),this.room.runState!==r.ENUM_RUN_STATE.logout?this.room.runState===r.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:e)):this.room.runState===r.ENUM_RUN_STATE.login&&(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.runState!==r.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.stopTokenTimer(),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" result=",e.body&&e.body.err_code?e.body.err_code:"-1")},e}();t.RoomHandler=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var r=o(0),s=o(6),i=o(7),n=o(8),a=o(9),l=o(22),g=o(23),d=o(1),_=o(4),u=function(){function e(e,t,o,d){this.stateCenter=e,this.logger=t,this.dataReport=o,this.service=d,this.roomID="",this.dispatchServer="",this.deviceID="",this.deviceType="",this.anType=0,this.sessionExpire="",this.pri_roomID="",this.roomSid="0",this.roomFlag=1,this.timeStamp=0,this.netType=2,this.userSeq=0,this.hallRunState=r.ENUM_RUN_STATE.logout,this.hallToken="",this.roomSessionID="",this.lastHallRunState=r.ENUM_RUN_STATE.logout,this.runRoomState=r.ENUM_RUN_STATE.logout,this.lastRunRoomState=r.ENUM_RUN_STATE.logout,this.lastHallState="DISCONNECTED",this.hallState="DISCONNECTED",this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.sessionID="",this.hallHandler=new l.HallHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.roomPrivateHandler=new g.RoomPrivateHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new s.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.userHandler=new a.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.messageHandler=new n.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.stateCenter.priModules),this.liveHandler=new i.LiveHandler(this.logger,this.stateCenter,this.service,this.stateCenter.priModules),this.init()}return e.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindHallHandler(),this.bindMessageHandler(),this.bindLiveHandler(),this.bindRoomHandler()},e.prototype.bindSocketHandler=function(){var e=this;this.service.handleHallKickout=function(t){e.hallHandler.handleHallKickout(t)},this.service.handlePushKickout=function(t){e.logger.info("zb.cm.bsh.0  call hpk");var o=r.getReportSeq();e.dataReport.newReport(o,_.ZegoRTMLogEvent.kZegoTaskRoomKickout.event),e.dataReport.addMsgInfo(o,{user_id:_.ZegoRTMLogEvent.kZegoTaskRoomKickout.user_id(e.stateCenter.idName),room_id:_.ZegoRTMLogEvent.kZegoTaskRoomKickout.room_id(e.stateCenter.priModules.roomID)}),e.dataReport.addMsgInfo(o,{error:t.body.reason,message:t.body.message}),e.dataReport.uploadReport(o),e.setRoomRunState(r.ENUM_RUN_STATE.logout),e.roomPrivateHandler.resetRoom();var s={};t&&t.body&&(t.body.reason&&(s.custom_kickout_message=t.body.message),t.body.reason&&(s.reason=t.body.reason)),e.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:d.errorCodeList.MULTIPLE_LOGIN_KICKOUT.code,msg:s}),e.logger.info("zb.cm.bsh.0  call hpk success")},this.service.handlePushUserStateUpdateMsg=function(t){e.userHandler.handlePushUserStateUpdateMsg(t)},this.service.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.service.handlePushRoomMsg=function(t){e.messageHandler.handlePushRoomMsg(t)},this.service.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.service.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.service.handlePushSignalMsg=function(t){e.liveHandler.handlePushSignalMsg(t)}},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.hallHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.HBResponse(t)}},e.prototype.bindHallHandler=function(){var e=this;this.hallHandler.loginSuccessCallBack=function(t,o){if(e.heartBeatHandler.init(o),e.service.startCheck(),e.runRoomState===r.ENUM_RUN_STATE.login){var s=function(t,o){0!==t.body.code?(e.setRoomRunState(r.ENUM_RUN_STATE.logout),e.roomPrivateHandler.roomStateHandle("DISCONNECTED",{code:t.body.code,msg:t.body.message})):(e.timeStamp=t.header.timeStamp,e.roomSid=t.body.room_header.room_sid,e.roomSessionID=t.body.room_header.room_user_session_id,e.userSeq=t.body.userlist_seq,e.setRoomRunState(r.ENUM_RUN_STATE.login),e.roomPrivateHandler.roomStateHandle("CONNECTED",{code:0,msg:""}),e.userHandler.loginPrivateRsp(t),e.roomLoginResponse(t))};e.roomPrivateHandler.enterRoom(s,s)}},this.hallHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler()}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.bindRoomHandler=function(){var e=this;this.roomPrivateHandler.resetRoomCallBack=function(){e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler()}},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.setRoomRunState=function(e){this.roomPrivateHandler.setRoomRunState(e)},e.prototype.isLogin=function(){return this.hallRunState===r.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HallHandler=void 0;var r=o(0),s=o(3),i=o(0),n=o(2),a=o(1),l=o(4),g=function(){function e(e,t,o,r,s){this.logger=e,this.stateCenter=t,this.dataReport=o,this.service=r,this.room=s,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRunState=function(e){this.room.lastHallRunState=this.room.hallRunState,this.room.hallRunState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetHall=function(){var e=this;if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.hallRunState!==r.ENUM_RUN_STATE.logout){var t=function(t){e.handleLogoutRsp(t)};this.service.logoutHall(t,t)}this.setRunState(r.ENUM_RUN_STATE.logout),this.stateCenter.userid="",this.room.sessionID="",this.room.roomSessionID="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket(),this.resetRoomCallBack(),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handleHallKickout=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+e);var t=i.getReportSeq();this.dataReport.newReport(t,l.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(t,{user_id:l.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var o=s.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(t,{error:o.code,message:o.message}),this.dataReport.uploadReport(t),this.resetHall();var r={};e&&e.body&&(e.body.reason&&(r.custom_kickout_message=e.body.message),e.body.reason&&(r.reason=e.body.reason)),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,"DISCONNECTED",a.errorCodeList.MULTIPLE_LOGIN_KICKOUT.code,r)},e.prototype.handleHbLogout=function(e){var t=this,o=this.room.retryHallHandler;o&&(o.onactive=function(e,o){t.disconnectedHandle(o)},e==a.errorCodeList.HEARTBEAT_TIMEOUT||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(o.startMaxTime(),o.active()):(o.stopMaxTime(),o.invalid(),this.resetHall(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.error.ROOM_DISCONNECT.code,message:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var o=void 0;(o=e.code<2e9&&e.code>1e9||e.code<1e6?s.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:o.code,message:o.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,s.ClientUtil.unregisterCallback(l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event,this.stateCenter.reportList);var r=this.room.retryHallHandler;r?(r.onactive=function(e,o){o?t.hallStateHandle("DISCONNECTED",o):t.hallStateHandle("CONNECTED",o)},r.startMaxTime(),r.active()):this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.hallStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e){e?this.hallStateHandle("DISCONNECTED",e):this.hallStateHandle("CONNECTED",e)},e.prototype.hallStateHandle=function(e,t,o){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastHallState=this.room.hallState,this.room.hallState=e,this.room.hallState!==this.room.lastHallState&&(this.stateCenter.actionListener("hallStateUpdate",e,t?t.code:0,o||""),this.stateCenter.actionListener("_hallStateUpdate",e,t?t.code:0,o||""),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,o))},e.prototype.loginHall=function(e,t,o,g,d){if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:"),this.logger.setSessionInfo(this.stateCenter.appid,"","",t.userID,"",this.stateCenter.sdKVersion),!this.stateCenter.configOK)return this.logger.error(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void d(a.errorCodeList.INIT);if(this.room.hallRunState!==r.ENUM_RUN_STATE.trylogin&&this.setRunState(r.ENUM_RUN_STATE.trylogin),this.stateCenter.idName=t.userID,this.stateCenter.nickName=t.userName||t.userID,s.ClientUtil.registerCallback("login",{success:g,error:d},this.stateCenter.callbackList),0===this.stateCenter.reportSeqList.login){var _=i.getReportSeq();this.stateCenter.reportSeqList.relogin=_,this.dataReport.newReport(_,l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event),s.ClientUtil.logReportCallback(l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event,this.dataReport,_,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLoginHall(e),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLoginHall=function(e){var t=this;if(this.room.hallRunState===r.ENUM_RUN_STATE.trylogin){var o=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)&&(this.tryLoginCount>1&&s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){t.openHandler()})),this.service.closeHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e)),t.service.closeSocket(),t.closeHandler(e)})),this.service.errorHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e)),t.service.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event);var a=function(e,o){t.handleLoginRsp(e,o)};this.service.loginHall(a,a)}this.tryLoginTimer=setTimeout((function(){t.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),s.ClientUtil.actionErrorCallback("login",t.stateCenter.callbackList)(l.ZegoRTMLogEvent.kZegoTaskLoginHall.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(i.REPORT_ACTION.eventEndWithMsgInfo,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event);var o=function(t,o){e.handleLoginRsp(t,o)};this.service.loginHall(o,o)},e.prototype.handleLoginRsp=function(e,t){var o=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;if(s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(o,this.stateCenter.reportList)(i.REPORT_ACTION.eventEndWithMsgInfo,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event),this.room.hallRunState===r.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.code?(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.code),void this.handleLoginFail(e)):(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),void this.handleLoginSuccess(e));this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq)}else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t={code:e.body.code,msg:e.body.message};s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},o=this.room.lastHallRunState;this.setRunState(r.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_uid,this.room.sessionID=e.body.session_id,this.room.timeStamp=e.header.timestamp,this.room.roomSessionID=e.body.room_session_id,this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.log_sever_addr&&""!=e.body.log_sever_addr&&this.logger.logRemoteLevel!==r.ENUM_LOG_LEVEL.disable&&(this.logger.setLogServer(e.body.log_sever_addr),t.log_url=e.body.log_sever_addr),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var n=0!==this.stateCenter.reportSeqList.login?l.ZegoRTMLogEvent.kZegoTaskLoginHall.event:l.ZegoRTMLogEvent.kZegoTaskReLoginHall.event;s.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.event,l.ZegoRTMLogEvent.kZegoTaskLoginHall.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(o,e),s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)&&s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0),this.hallStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code)),this.room.hallRunState!==r.ENUM_RUN_STATE.logout?this.room.hallRunState===r.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(1006==e.code?l.ZegoRTMLogEvent.kZegoTaskLoginHall.error.LOGIN_TIMEOUT:e)):this.room.hallRunState===r.ENUM_RUN_STATE.login&&(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(l.ZegoRTMLogEvent.kZegoTaskLoginHall.error.NETWORK_BROKEN)):this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.hallRunState!==r.ENUM_RUN_STATE.logout?(this.resetHall(),this.hallStateHandle("DISCONNECTED",{code:0,msg:""}),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+"result=",e.body&&e.body.err_code?e.body.err_code:"")},e}();t.HallHandler=g},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomPrivateHandler=void 0;var r=o(0),s=o(2),i=function(){function e(e,t,o,r,s){this.logger=e,this.stateCenter=t,this.dataReport=o,this.service=r,this.room=s,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRoomRunState=function(e){this.room.lastRunRoomState=this.room.runRoomState,this.room.runRoomState=e},e.prototype.enterRoom=function(e,t){this.service.enterRoom(e,t)},e.prototype.leaveRoom=function(e,t){this.resetRoom(e,t)},e.prototype.resetRoom=function(e,t){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call");var o=e||function(){},i=t||function(){};this.room.runRoomState!==r.ENUM_RUN_STATE.logout&&this.service.leaveRoom(o,i),this.setRoomRunState(r.ENUM_RUN_STATE.logout),this.room.roomSid="0",this.room.roomSessionID="0",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.resetRoomCallBack(),this.logger.info(s.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.roomStateHandle=function(e,t,o){this.logger.info(s.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,o||""),this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,o||""))},e}();t.RoomPrivateHandler=i},function(e,t,o){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHallHandler=void 0;var i=o(5),n=o(0),a=o(2),l=o(1),g=function(e){function t(t,o,r){var s=e.call(this,t,o)||this;return s.logger=t,s.stateCenter=o,s.room=r,s}return s(t,e),t.prototype.initRoom=function(e,t,o,r){this.hallHandler=e,this.user=t,this.server=o,this.config=r},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.stateCenter.networkState!=n.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var o=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=o>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:o}this.retryTimer=setTimeout((function(){t.hallHandler.loginHall(t.server,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,o){t.handleLoginFinish(!1,e,o)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){console.warn("over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.hallHandler.resetHall(),e.stopMaxTime(),e.invalid(),e.onactive(!1,l.errorCodeList.LOGIN_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var o=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(o)&&(!!["1100040001","1100040100"].includes(o)||this.room.lastHallRunState==n.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.handleLoginFinish=function(e,t,o){t?this.handleError(t,o)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.hallHandler.resetHall(),this.stopMaxTime(),this.invalid(),this.onactive(e,t)):(this.stopMaxTime(),this.invalid(),this.onactive(e))},t}(i.TryHandler);t.RetryHallHandler=g},function(e,t,o){"use strict";var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomPrivateService=void 0;var i=o(11),n=o(0),a=o(2),l=function(e){function t(t,o){var r=e.call(this,t,o)||this;return r.stateCenter=t,r.logger=o,r.service=new i.ZegoSocketService(r.stateCenter.ENV),r.cmdSeq=0,r.responseRouters={},r}return s(t,e),t.prototype.checkResponse=function(e){return e.header.app_id!==this.stateCenter.appid||e.header.user_uid!==this.stateCenter.userid||this.stateCenter.priModules.hallRunState!==n.ENUM_RUN_STATE.login},t.prototype.handleSendCommandMsgRsp=function(e){var t=this,o=this.service.sendCommandMap[e.header.seq];if(null!=o){var r=o._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(o),0===e.body.code||e.body.mod_rsp_header&&0===e.body.mod_rsp_header.code?setTimeout((function(){r&&null!=r.success&&r.success(e,t.cmdSeq)}),0):setTimeout((function(){r&&null!=r.error&&r.error(e,t.cmdSeq)}),0)}},t.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg="+JSON.stringify(t)+" "),0!==t.body.code&&t.body.code&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", code="+t.body.code+", message="+t.body.message+" "),["zegochat_js.user_login_ws_rsp","zegochat_js.user_logout_rsp"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.stateCenter.priModules.isLogin()?e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq)):e.logger.warn(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  already logout")}},t.prototype.handleHallKickout=function(e){},t.prototype.handlePushKickout=function(e){},t.prototype.handlePushCustomMsg=function(e){},t.prototype.handlePushRoomMsg=function(e){},t.prototype.handlePushUserStateUpdateMsg=function(e){},t.prototype.handlePushMergeMsg=function(e){},t.prototype.handlePushTransMsg=function(e){},t.prototype.handleBigImMsgRsp=function(e){},t.prototype.handlePushSignalMsg=function(e){},t.prototype.closeHandler=function(e){this.service.closeHandler(e)},t.prototype.openHandler=function(e){this.service.openHandler(e)},t.prototype.errorHandler=function(e){this.service.errorHandler(e)},t.prototype.getHeader=function(e){return{cmd:e,seq:++this.cmdSeq,timestamp:Math.ceil((new Date).getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.priModules.sessionID||"0"}},t.prototype.startCheck=function(){this.service.startCheck()},t.prototype.stopCheck=function(){this.service.stopCheck()},t.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},t.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters={"zegochat_js.push_user_kickout":function(e){t.handleHallKickout(e)},"zegochat_js.push_room_kickout":function(e){t.handlePushKickout(e)},"zegochat_js.push_room_custommsg_req":function(e){t.handlePushCustomMsg(e)},"zegochat_js.push_room_im_chat_req":function(e){t.handlePushRoomMsg(e)},"zegochat_js.push_room_userlist_update_req":function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}}},t.prototype.closeSocket=function(){this.service.closeSocket()},t.prototype.sendMessage=function(e,t,o,r){if(this.service.isDisConnect())return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),0;var s=this.getHeader(e);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:s,body:t})),this.service.sendMessage(s,t,o,r)},t.prototype.on=function(e,t){this.responseRouters[e]=t},t.prototype.loginHall=function(e,t){var o={user_id:this.stateCenter.idName,device_id:this.stateCenter.priModules.deviceID,session_expire:this.stateCenter.priModules.sessionExpire,user_name:this.stateCenter.nickName,device_type:this.stateCenter.priModules.deviceType,net_type:this.stateCenter.priModules.netType,token:this.stateCenter.priModules.hallToken,an_type:this.stateCenter.priModules.anType+""};this.sendMessage("zegochat_js.user_login_ws_req",o,e,t)},t.prototype.logoutHall=function(e,t){var o={user_id:this.stateCenter.idName||0};this.sendMessage("zegochat_js.user_logout_req",o,e,t)},t.prototype.enterRoom=function(e,t){var o={room_header:{room_id:this.stateCenter.priModules.roomID,room_sid:this.stateCenter.priModules.roomSid||"0",room_user_session_id:this.stateCenter.priModules.roomSessionID||"0"},room_name:"",role:this.stateCenter.role,room_flag:this.stateCenter.priModules.roomFlag};this.sendMessage("zegochat_js.room_enter_req",o,e,t)},t.prototype.leaveRoom=function(e,t){var o={room_header:{room_id:this.stateCenter.priModules.roomID,room_sid:this.stateCenter.priModules.roomSid,room_user_session_id:this.stateCenter.priModules.roomSessionID}};this.sendMessage("zegochat_js.room_quit_req",o,e,t)},t.prototype.heartBeat=function(e,t){return this.sendMessage("zegochat_js.user_hb_req",{reserve:0},e,t)},t.prototype.fetchUserList=function(e,t,o){return this.sendMessage("zegochat_js.room_userlist_req",e,t,o)},t.prototype.fetchReliableMessage=function(e,t,o){return this.sendMessage("trans_fetch",e,t,o)},t.prototype.sendReliableMessage=function(e,t,o){return this.sendMessage("trans",e,t,o)},t.prototype.sendRoomMsg=function(e,t,o){return this.sendMessage("zegochat_js.room_im_chat",e,t,o)},t.prototype.sendCustomCommand=function(e,t,o){return this.sendMessage("zegochat_js.room_custommsg_req",e,t,o)},t.prototype.sendBigRoomMessage=function(e,t,o){return this.sendMessage("bigim_chat",e,t,o)},t.prototype.sendRelayMessage=function(e,t,o){return this.sendMessage("relay",e,t,o)},t.prototype.sendSignalCmd=function(e,t,o){return this.sendMessage("signal",e,t,o)},t}(o(10).LiveRoomService);t.LiveRoomPrivateService=l}])}));